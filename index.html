<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Relat√≥rio de Turno - GrupoGPS v4.1</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #2563eb;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --white: #ffffff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--gray-100) 0%, var(--gray-200) 100%);
            color: var(--gray-900);
            line-height: 1.6;
            min-height: 100vh;
        }

        .app-container {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-brand {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--gray-50);
            border-radius: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            color: var(--gray-600);
        }

        .sync-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .sync-dot.loading {
            background: var(--warning-color);
            animation: pulse 2s infinite;
        }

        .sync-dot.error {
            background: var(--danger-color);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .btn {
            background: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn:hover {
            background: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-sm { padding: 0.5rem 1rem; font-size: 0.875rem; }
        .btn-lg { padding: 1rem 2rem; font-size: 1.125rem; }
        .btn-secondary { background: var(--secondary-color); }
        .btn-secondary:hover { background: var(--gray-700); }
        .btn-success { background: var(--success-color); }
        .btn-success:hover { background: #059669; }
        .btn-warning { background: var(--warning-color); }
        .btn-warning:hover { background: #d97706; }
        .btn-danger { background: var(--danger-color); }
        .btn-danger:hover { background: #dc2626; }
        .btn-info { background: var(--info-color); }
        .btn-info:hover { background: #2563eb; }

        /* Navigation */
        .nav-tabs {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            overflow-x: auto;
        }

        .nav-tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
        }

        .nav-tab {
            padding: 1rem 2rem;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            transition: all 0.2s;
            white-space: nowrap;
            font-size: 0.95rem;
        }

        .nav-tab:hover {
            color: var(--primary-color);
            background: var(--gray-50);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background: var(--gray-50);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards */
        .card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .card-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            background: var(--gray-50);
        }

        .card-title {
            font-weight: 700;
            color: var(--gray-900);
            font-size: 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-content {
            padding: 2rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-color);
        }

        .stat-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--gray-600);
            font-size: 0.95rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            font-weight: 600;
            color: var(--gray-700);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem;
            border: 2px solid var(--gray-200);
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s;
            background: var(--white);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.75rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 3rem;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }

        .form-radio, .form-checkbox {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .form-radio input, .form-checkbox input {
            width: 1.25rem;
            height: 1.25rem;
            accent-color: var(--primary-color);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-top: 2rem;
            justify-content: center;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .step-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            background: var(--gray-100);
            border-radius: 8px;
            color: var(--gray-500);
            font-weight: 600;
            transition: all 0.3s;
        }

        .step-item.active {
            background: var(--primary-color);
            color: var(--white);
            transform: scale(1.05);
        }

        .step-item.completed {
            background: var(--success-color);
            color: var(--white);
        }

        .step-number {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            background: var(--white);
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .step-item.active .step-number {
            background: var(--white);
            color: var(--primary-color);
        }

        .step-item.completed .step-number {
            background: var(--white);
            color: var(--success-color);
        }

        /* Team Cards */
        .teams-container {
            display: grid;
            gap: 1.5rem;
        }

        .team-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }

        .team-card.alta-pressao {
            border-left: 4px solid var(--success-color);
        }

        .team-card.vacuo {
            border-left: 4px solid var(--danger-color);
        }

        .team-card.horas-extras {
            border-left: 4px solid var(--warning-color);
        }

        .team-header {
            padding: 1.5rem;
            background: var(--gray-50);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .team-info h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .team-info p {
            color: var(--gray-600);
            font-size: 0.875rem;
        }

        .team-content {
            padding: 1.5rem;
        }

        .team-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            padding: 1rem;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .detail-label {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray-500);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }

        .modal.show {
            display: flex !important;
        }

        .modal-content {
            background: var(--white);
            border-radius: 16px;
            max-width: 1000px;
            width: 100%;
            max-height: 95vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .modal-header {
            padding: 2rem 2rem 1rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--gray-400);
            padding: 0.5rem;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            color: var(--gray-600);
            background: var(--gray-100);
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-footer {
            padding: 1rem 2rem 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            background: var(--white);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
            font-size: 0.875rem;
        }

        .data-table th {
            background: var(--gray-50);
            font-weight: 600;
            color: var(--gray-900);
            position: sticky;
            top: 0;
        }

        .data-table tr:hover {
            background: var(--gray-50);
        }

        /* Badge */
        .badge {
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.025em;
        }

        .badge-primary { background: rgba(37, 99, 235, 0.1); color: var(--primary-color); }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: var(--success-color); }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: var(--warning-color); }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger-color); }
        .badge-info { background: rgba(59, 130, 246, 0.1); color: var(--info-color); }
        .badge-secondary { background: rgba(100, 116, 139, 0.1); color: var(--secondary-color); }

        /* Notifications */
        .notification {
            position: fixed;
            top: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            color: var(--white);
            font-weight: 600;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            max-width: 400px;
            animation: slideInRight 0.3s ease-out;
        }

        .notification.success { background: var(--success-color); }
        .notification.error { background: var(--danger-color); }
        .notification.warning { background: var(--warning-color); }
        .notification.info { background: var(--info-color); }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: var(--white);
            padding: 3rem;
            border-radius: 16px;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .loading-spinner {
            width: 3rem;
            height: 3rem;
            border: 3px solid var(--gray-300);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            color: var(--gray-700);
            font-weight: 600;
        }

        /* Report View */
        .report-container {
            background: var(--gray-50);
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 2rem;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.5;
            max-height: 600px;
            overflow-y: auto;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--gray-500);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state h3 {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
            color: var(--gray-700);
        }

        .empty-state p {
            font-size: 0.875rem;
        }

        /* Success Animation */
        .success-animation {
            text-align: center;
            padding: 3rem;
        }

        .success-icon {
            font-size: 4rem;
            color: var(--success-color);
            margin-bottom: 1rem;
            animation: bounce 1s ease-in-out;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        /* Implementos Section */
        .implementos-section {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .implementos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .implemento-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .implemento-item label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--gray-700);
            min-width: 100px;
        }

        .implemento-item select {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid var(--gray-300);
            border-radius: 4px;
            font-size: 0.875rem;
        }

        /* Troca Item Styling */
        .troca-item {
            border: 1px solid var(--gray-200);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            background: var(--white);
        }

        .troca-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            position: relative;
        }

        .troca-title {
            font-weight: 600;
            color: var(--gray-900);
        }

        .btn-remove-troca {
            background: var(--danger-color);
            color: var(--white);
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.875rem;
            z-index: 1;
        }

        /* Atraso Section */
        .atraso-section {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--warning-color);
            color: white;
            border-radius: 8px;
        }

        .atraso-section h5 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .atraso-section .form-label {
            color: white;
            font-weight: 600;
        }

        .atraso-section .form-select,
        .atraso-section .form-textarea,
        .atraso-section .form-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--gray-900);
        }

        /* Campo customizado para "Outro" */
        .campo-outro {
            margin-top: 0.5rem;
        }

        .campo-outro input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gray-200);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .observacoes-gerais {
            margin-top: 2rem;
            padding: 1.5rem;
            background: var(--info-color);
            color: white;
            border-radius: 8px;
        }

        .observacoes-gerais h5 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .observacoes-gerais .form-label {
            color: white;
            font-weight: 600;
        }

        .observacoes-gerais .form-textarea {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: var(--gray-900);
        }
        
        /* CSS Adicional da Implementa√ß√£o */
        .turno-fields {
            transition: all 0.3s ease;
        }

        .turno-fields.hidden {
            display: none;
        }

        .troca-item[id^="turnoTrabalho_"] {
            position: relative;
        }

        .troca-item[id^="turnoTrabalho_"]::before {
            content: 'üîÑ';
            position: absolute;
            top: 1rem;
            right: 8rem;
            font-size: 1.5rem;
            opacity: 0.2;
            pointer-events: none;
        }

        .badge-multiturno {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--info-color) 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Responsive Design - Melhorado */
        @media (max-width: 1024px) {
            .main-content {
                padding: 1.5rem;
            }
            
            .card-content {
                padding: 1.5rem;
            }
            
            .modal-content {
                margin: 1rem;
                max-height: 90vh;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .header-controls {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .header-brand {
                font-size: 1.25rem;
            }

            .main-content {
                padding: 1rem;
            }

            .card-content {
                padding: 1rem;
            }

            .nav-tab {
                padding: 0.75rem 1rem;
                font-size: 0.875rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }

            .form-actions {
                flex-direction: column;
            }
            
            .btn {
                padding: 0.875rem 1.5rem;
                font-size: 0.95rem;
                width: 100%;
                justify-content: center;
            }

            .card-header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }

            .step-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .step-item {
                padding: 0.75rem 1rem;
            }

            .team-details {
                grid-template-columns: 1fr;
            }

            .implementos-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 0.5rem;
                max-height: 90vh;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-body > form > div {
                grid-template-columns: 1fr !important;
                gap: 1.5rem;
            }

            .team-header {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .table-container {
                font-size: 0.8rem;
            }
            
            .data-table th,
            .data-table td {
                padding: 0.5rem;
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .header-brand {
                font-size: 1.1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                margin: 0.5rem;
                max-height: 95vh;
            }

            .card-content {
                padding: 1rem;
            }
            
            .step-item {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
            
            .step-number {
                width: 1.5rem;
                height: 1.5rem;
                font-size: 0.75rem;
            }
            
            .btn {
                padding: 0.75rem 1.25rem;
                font-size: 0.875rem;
            }
            
            .form-input,
            .form-select,
            .form-textarea {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            .nav-tabs {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            .nav-tab {
                min-width: 120px;
                flex-shrink: 0;
            }
        }

        @media (max-width: 360px) {
            .main-content {
                padding: 0.75rem;
            }
            
            .card {
                margin-bottom: 1rem;
            }
            
            .card-content {
                padding: 0.75rem;
            }
            
            .modal-body {
                padding: 0.75rem;
            }
        }

        .hidden { display: none !important; }
        .show { display: block !important; }
    </style>
</head>
<body>
    <div class="app-container" id="appContainer">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand">
                    Sistema de Relat√≥rio de Turno
                </div>
                
                <div class="header-controls">
                    <div class="user-info">
                        <span id="currentUser">Sistema Interno</span>
                    </div>
                    
                    <div class="sync-status">
                        <div class="sync-dot" id="syncDot"></div>
                        <span id="syncStatus">Conectado</span>
                    </div>
                    
                    <button class="btn btn-sm btn-info" onclick="forceRefresh()">
                        Atualizar
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <div class="nav-tabs-container">
                <div class="nav-tab active" onclick="switchTab('novo-relatorio')">
                    Novo Relat√≥rio
                </div>
                <div class="nav-tab" onclick="switchTab('relatorios')">
                    Relat√≥rios
                </div>
                <div class="nav-tab" onclick="switchTab('pesquisa')">
                    Pesquisar
                </div>
                <div class="nav-tab" onclick="switchTab('configuracoes')">
                    Configura√ß√µes
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Novo Relat√≥rio Tab -->
            <div id="novo-relatorio-tab" class="tab-content active">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step-item active" id="step1">
                        <div class="step-number">1</div>
                        <span>Informa√ß√µes do Turno</span>
                    </div>
                    <div class="step-item" id="step2">
                        <div class="step-number">2</div>
                        <span>Equipes</span>
                    </div>
                    <div class="step-item" id="step3">
                        <div class="step-number">3</div>
                        <span>Revis√£o</span>
                    </div>
                </div>

                <!-- Etapa 1: Informa√ß√µes do Turno -->
                <div id="etapa1" class="step-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Informa√ß√µes B√°sicas do Turno</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Data do Turno *</label>
                                    <input type="date" id="dataTurno" class="form-input" required>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Hor√°rio do Turno *</label>
                                    <select id="horarioTurno" class="form-select" required>
                                        <option value="">Selecione o hor√°rio...</option>
                                        <option value="07:00 - 19:00">07:00 - 19:00</option>
                                        <option value="19:00 - 07:00">19:00 - 07:00</option>
                                        <option value="ADM">ADM</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Letra do Turno *</label>
                                    <select id="letraTurno" class="form-select" required>
                                        <option value="">Selecione a letra...</option>
                                        <option value="A">A</option>
                                        <option value="B">B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Supervisor Respons√°vel *</label>
                                    <select id="supervisorTurno" class="form-select" required>
                                        <option value="">Selecione o supervisor...</option>
                                        <!-- Preenchido via JavaScript -->
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Se√ß√£o Teste de Etil√¥metro -->
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header" style="background: var(--warning-color); color: white;">
                            <h3 class="card-title">üß™ Teste de Etil√¥metro Di√°rio (OBRIGAT√ìRIO)</h3>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label class="form-label" style="font-weight: 700; color: var(--danger-color);">
                                    * Todos os colaboradores realizaram o teste de etil√¥metro hoje?
                                </label>
                                <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                                    <div class="form-radio">
                                        <input type="radio" name="etilometroRealizado" id="etilometroSim" value="Sim" checked onchange="toggleEtilometroAusencias()">
                                        <label for="etilometroSim">Sim, todos realizaram</label>
                                    </div>
                                    <div class="form-radio">
                                        <input type="radio" name="etilometroRealizado" id="etilometroNao" value="N√£o" onchange="toggleEtilometroAusencias()">
                                        <label for="etilometroNao">N√£o, h√° aus√™ncias</label>
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Hor√°rio de Realiza√ß√£o do Teste *</label>
                                <input type="time" id="horarioEtilometro" class="form-input" required value="07:00">
                            </div>

                            <!-- Container para colaboradores ausentes -->
                            <div id="etilometroAusenciasContainer" class="hidden" style="margin-top: 2rem; padding: 1.5rem; background: var(--gray-50); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h5 style="color: var(--danger-color);">‚ö†Ô∏è Colaboradores que N√ÉO realizaram o teste</h5>
                                    <button type="button" class="btn btn-sm btn-danger" onclick="adicionarAusenciaEtilometro()">
                                        + Adicionar Colaborador
                                    </button>
                                </div>
                                
                                <div id="listaAusenciasEtilometro">
                                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                                        Nenhuma aus√™ncia registrada. Se houver aus√™ncias, clique em "Adicionar Colaborador".
                                    </p>
                                </div>
                            </div>

                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Observa√ß√µes sobre o teste (opcional)</label>
                                <textarea id="observacoesEtilometro" class="form-textarea" rows="2" placeholder="Observa√ß√µes gerais sobre o teste de etil√¥metro..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Se√ß√£o Faltas de Colaboradores -->
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header" style="background: var(--danger-color); color: white;">
                            <h3 class="card-title">üë• Gest√£o de Faltas e Substitui√ß√µes</h3>
                        </div>
                        <div class="card-content">
                            <div class="form-group">
                                <label class="form-label" style="font-weight: 700;">
                                    * Houve falta de algum colaborador neste turno?
                                </label>
                                <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                                    <div class="form-radio">
                                        <input type="radio" name="houveFaltas" id="faltasNao" value="N√£o" checked onchange="toggleFaltasContainer()">
                                        <label for="faltasNao">N√£o</label>
                                    </div>
                                    <div class="form-radio">
                                        <input type="radio" name="houveFaltas" id="faltasSim" value="Sim" onchange="toggleFaltasContainer()">
                                        <label for="faltasSim">Sim</label>
                                    </div>
                                </div>
                            </div>

                            <!-- Container para faltas -->
                            <div id="faltasContainer" class="hidden" style="margin-top: 2rem; padding: 1.5rem; background: var(--gray-50); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h5 style="color: var(--danger-color);">üìã Registro de Faltas</h5>
                                    <button type="button" class="btn btn-sm btn-danger" onclick="adicionarFalta()">
                                        + Registrar Falta
                                    </button>
                                </div>
                                
                                <div id="listaFaltas">
                                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                                        Nenhuma falta registrada. Clique em "Registrar Falta" para adicionar.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Equipamentos Devendo -->
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header" style="background: var(--danger-color); color: white;">
                            <h3 class="card-title">‚ö†Ô∏è Equipamentos N√£o Atendidos (Devendo)</h3>
                        </div>
                        <div class="card-content">
                            <p style="margin-bottom: 1rem; color: var(--gray-600);">
                                Registre vagas/equipamentos que n√£o puderam ser atendidos por falta de equipamento ou m√£o de obra.
                            </p>
                            
                            <div class="form-group">
                                <label class="form-label" style="font-weight: 700;">
                                    * Ficou algum equipamento devendo neste turno?
                                </label>
                                <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                                    <div class="form-radio">
                                        <input type="radio" name="equipamentosDevendo" id="devendoNao" value="N√£o" checked onchange="toggleEquipamentosDevendo()">
                                        <label for="devendoNao">N√£o</label>
                                    </div>
                                    <div class="form-radio">
                                        <input type="radio" name="equipamentosDevendo" id="devendoSim" value="Sim" onchange="toggleEquipamentosDevendo()">
                                        <label for="devendoSim">Sim</label>
                                    </div>
                                </div>
                            </div>

                            <div id="equipamentosDevendoContainer" class="hidden" style="margin-top: 2rem; padding: 1.5rem; background: var(--gray-50); border-radius: 8px;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h5 style="color: var(--danger-color);">üìã Registro de Equipamentos Devendo</h5>
                                    <button type="button" class="btn btn-sm btn-danger" onclick="adicionarEquipamentoDevendo()">
                                        + Adicionar Equipamento
                                    </button>
                                </div>
                                
                                <div id="listaEquipamentosDevendo">
                                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                                        Nenhum equipamento registrado. Clique em "+ Adicionar Equipamento".
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-lg" onclick="nextStep()">
                            Pr√≥ximo: Adicionar Equipes
                        </button>
                    </div>

                </div>

                <!-- Etapa 2: Equipes -->
                <div id="etapa2" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Detalhes das Equipes</h2>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-success" onclick="adicionarEquipe('Alta Pressao')">
                                    + Alta Pressao
                                </button>
                                <button class="btn btn-danger" onclick="adicionarEquipe('Auto Vacuo / Hiper Vacuo')">
                                    + Vacuo/Hiper
                                </button>
                                <button class="btn btn-warning" onclick="adicionarEquipe('Horas Extras')">
                                    + Horas Extras
                                </button>
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="teams-container" id="teamsContainer">
                                <div class="empty-state">
                                    <div class="empty-state-icon">‚ö†Ô∏è</div>
                                    <h3>Nenhuma equipe adicionada</h3>
                                    <p>Clique nos bot√µes acima para adicionar equipes ao relat√≥rio</p>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary btn-lg" onclick="prevStep()">
                                    Voltar
                                </button>
                                <button type="button" class="btn btn-lg" onclick="nextStep()" id="btnProximoRevisao" disabled>
                                    Pr√≥ximo: Revis√£o
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Etapa 3: Revis√£o -->
                <div id="etapa3" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Revis√£o e Finaliza√ß√£o</h2>
                        </div>
                        <div class="card-content">
                            <div class="card" style="margin-bottom: 2rem;">
                                <div class="card-header">
                                    <h3 class="card-title">Resumo do Turno</h3>
                                </div>
                                <div class="card-content">
                                    <div id="resumoTurno" class="form-grid">
                                        <!-- Preenchido via JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h3 class="card-title">Resumo das Equipes</h3>
                                </div>
                                <div class="card-content">
                                    <div id="resumoEquipes">
                                        <!-- Preenchido via JavaScript -->
                                    </div>
                                </div>
                            </div>

                            <!-- Observa√ß√µes Gerais -->
                            <div class="observacoes-gerais">
                                <h5>üìù Observa√ß√µes Gerais do Turno</h5>
                                <div class="form-group">
                                    <label class="form-label">Houve alguma situa√ß√£o especial que deve ser mencionada?</label>
                                    <textarea id="observacoesGeraisTurno" class="form-textarea" rows="4" placeholder="Ex: Falta de colaborador, incidente, ponto de observa√ß√£o importante para o pr√≥ximo turno, etc."></textarea>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-secondary btn-lg" onclick="prevStep()">
                                    Voltar
                                </button>
                                <button type="button" class="btn btn-success btn-lg" onclick="salvarRelatorio()">
                                    Salvar Relat√≥rio
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Etapa 4: Sucesso -->
                <div id="etapa4" class="step-content" style="display: none;">
                    <div class="card">
                        <div class="card-content">
                            <div class="success-animation">
                                <div class="success-icon">‚úì</div>
                                <h2 style="color: var(--success-color); margin-bottom: 1rem;">Relat√≥rio Salvo com Sucesso!</h2>
                                <p style="color: var(--gray-600); margin-bottom: 2rem;">
                                    Relat√≥rio <strong id="relatorioIdDisplay"></strong> foi registrado no sistema.
                                </p>
                                
                                <div class="form-actions">
                                    <button class="btn btn-primary btn-lg" onclick="visualizarRelatorio()">
                                        Visualizar Relat√≥rio
                                    </button>
                                    <button class="btn btn-secondary" onclick="novoRelatorio()">
                                        Novo Relat√≥rio
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Relat√≥rios Tab -->
            <div id="relatorios-tab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRelatorios">0</div>
                        <div class="stat-label">Total de Relat√≥rios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="relatoriosHoje">0</div>
                        <div class="stat-label">Relat√≥rios Hoje</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="equipesTotal">0</div>
                        <div class="stat-label">Total de Equipes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="atividadesConcluidas">0</div>
                        <div class="stat-label">Atividades Conclu√≠das</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Relat√≥rios Registrados</h3>
                        <button class="btn btn-success" onclick="exportarRelatorios()">
                            Exportar Excel
                        </button>
                    </div>
                    <div class="card-content">
                        <div class="table-container">
                            <table class="data-table" id="tabelaRelatorios">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Data</th>
                                        <th>Hor√°rio</th>
                                        <th>Letra</th>
                                        <th>Supervisor</th>
                                        <th>Equipes</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="relatoriosTableBody">
                                    <tr>
                                        <td colspan="8">
                                            <div class="empty-state">
                                                <div class="empty-state-icon">üìã</div>
                                                <h3>Nenhum relat√≥rio encontrado</h3>
                                                <p>Crie seu primeiro relat√≥rio na aba "Novo Relat√≥rio"</p>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pesquisa Tab -->
            <div id="pesquisa-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Pesquisar Relat√≥rios</h3>
                    </div>
                    <div class="card-content">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Pesquisar por</label>
                                <select id="tipoPesquisa" class="form-select" onchange="ajustarCampoPesquisa()">
                                    <option value="geral">Termo Geral ou ID</option>
                                    <option value="data">Data Espec√≠fica</option>
                                    <option value="periodo">Per√≠odo</option>
                                    <option value="supervisor">Supervisor</option>
                                    <option value="letra">Letra do Turno</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="campoPesquisaGeral">
                                <label class="form-label">Termo de Pesquisa</label>
                                <input type="text" id="termoPesquisa" class="form-input" placeholder="Digite ID ou termo geral">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaData">
                                <label class="form-label">Data</label>
                                <input type="date" id="dataPesquisa" class="form-input">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaPeriodo">
                                <label class="form-label">Data Inicial</label>
                                <input type="date" id="dataInicialPesquisa" class="form-input">
                            </div>
                            
                            <div class="form-group hidden" id="campoPesquisaPeriodoFim">
                                <label class="form-label">Data Final</label>
                                <input type="date" id="dataFinalPesquisa" class="form-input">
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button class="btn btn-primary btn-lg" onclick="executarPesquisa()">
                                Pesquisar
                            </button>
                            <button class="btn btn-secondary" onclick="limparPesquisa()">
                                Limpar
                            </button>
                        </div>
                        
                        <div id="resultadosPesquisa" class="hidden" style="margin-top: 2rem;">
                            <h4 style="margin-bottom: 1rem;">Resultados da Pesquisa</h4>
                            <div class="table-container">
                                <table class="data-table" id="tabelaPesquisa">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Data</th>
                                            <th>Hor√°rio</th>
                                            <th>Letra</th>
                                            <th>Supervisor</th>
                                            <th>Equipes</th>
                                            <th>A√ß√µes</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pesquisaTableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes Tab -->
            <div id="configuracoes-tab" class="tab-content">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Configura√ß√µes do Sistema</h3>
                    </div>
                    <div class="card-content">
                        <!-- GitHub Configuration -->
                        <div class="card" style="margin-bottom: 2rem;">
                            <div class="card-header">
                                <h4 class="card-title">Configura√ß√µes GitHub</h4>
                            </div>
                            <div class="card-content">
                                <div id="setupInstruction" class="hidden" style="padding: 1rem; margin-bottom: 1rem; background-color: var(--warning-color); color: var(--white); border-radius: 8px;">
                                    <strong>Modo de Configura√ß√£o Ativado</strong><br>
                                    1. Insira seu Token de Acesso do GitHub e clique em "Salvar".<br>
                                    2. Clique em "Inicializar Sistema" para criar os arquivos no seu reposit√≥rio.<br>
                                    3. Ap√≥s a confirma√ß√£o, recarregue a p√°gina para usar o sistema normalmente.
                                </div>

                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Token de Acesso GitHub</label>
                                        <input type="password" id="githubToken" class="form-input" 
                                               placeholder="GitHub Personal Access Token">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Reposit√≥rio</label>
                                        <input type="text" id="githubRepo" class="form-input" 
                                               value="GrupoGps-Mecanizada/Relat-rio-Turno---Oficial" readonly>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-info" onclick="testarConexaoGitHub()">
                                        Testar Conex√£o
                                    </button>
                                    <button class="btn btn-success" onclick="salvarConfigGitHub()">
                                        Salvar Configura√ß√µes
                                    </button>
                                    <button class="btn btn-warning hidden" id="btnInitializeSystem" onclick="initializeSystemFiles()">
                                        Inicializar Sistema
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- General Settings -->
                        <div class="card">
                            <div class="card-header">
                                <h4 class="card-title">Configura√ß√µes Gerais</h4>
                            </div>
                            <div class="card-content">
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label class="form-label">Nome da Empresa</label>
                                        <input type="text" id="nomeEmpresa" class="form-input" value="GrupoGPS">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Atualiza√ß√£o Autom√°tica (segundos)</label>
                                        <input type="number" id="autoRefreshInterval" class="form-input" value="60" min="30">
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Backup Autom√°tico</label>
                                        <select id="autoBackup" class="form-select">
                                            <option value="true">Ativado</option>
                                            <option value="false">Desativado</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="btn btn-success" onclick="salvarConfigGerais()">
                                        Salvar Configura√ß√µes
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer style="background: var(--white); border-top: 1px solid var(--gray-200); padding: 1.5rem; text-align: center; color: var(--gray-600);">
            <p>Desenvolvido por <strong style="color: var(--primary-color);">Warlison Abreu</strong> | ¬© 2025 GrupoGPS - Sistema de Relat√≥rio de Turno</p>
        </footer>
    </div>

    <!-- Modal Adicionar/Editar Equipe -->
    <div class="modal" id="modalEquipe">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalEquipeTitle">Adicionar Equipe</h3>
                <button class="modal-close" onclick="confirmCloseModal('modalEquipe')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="formEquipe" onsubmit="salvarEquipe(event)">
                    <input type="hidden" id="equipeIndex" value="-1">
                    <input type="hidden" id="equipeTipo" value="">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Coluna Esquerda: Informa√ß√µes Gerais -->
                        <div>
                            <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Informa√ß√µes da Equipe</h4>
                            
                            <div class="form-group">
                                <label class="form-label">N√∫mero da Equipe</label>
                                <input type="text" id="equipeNumero" class="form-input" readonly style="background: var(--gray-100);">
                                <small style="color: var(--gray-500); font-size: 0.8rem;">Gerado automaticamente baseado no tipo e quantidade de equipes</small>
                            </div>
                            
                            <div class="form-group" style="background: var(--info-color); color: white; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                                <label class="form-label" style="color: white; font-size: 1.1rem;">
                                    üîÑ Regime de Trabalho desta Vaga
                                </label>
                                <p style="font-size: 0.875rem; margin-bottom: 1rem; opacity: 0.9;">
                                    Selecione se esta vaga trabalha em turno √∫nico ou se h√° troca de equipe durante o dia (m√∫ltiplos turnos).
                                </p>
                                
                                <div style="display: flex; gap: 2rem; margin-bottom: 1rem;">
                                    <div class="form-radio">
                                        <input type="radio" name="regimeTrabalho" id="turnoUnico" value="turno-unico" checked onchange="toggleRegimeTurno()">
                                        <label for="turnoUnico" style="color: white;">Turno √önico (equipe trabalha o turno todo)</label>
                                    </div>
                                    <div class="form-radio">
                                        <input type="radio" name="regimeTrabalho" id="multiTurno" value="multi-turno" onchange="toggleRegimeTurno()">
                                        <label for="multiTurno" style="color: white;">M√∫ltiplos Turnos (troca de equipe durante o dia)</label>
                                    </div>
                                </div>
                                
                                <div id="infoMultiTurno" class="hidden" style="background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 6px;">
                                    <small style="color: white; font-weight: 600;">
                                        ‚ÑπÔ∏è No modo M√∫ltiplos Turnos, voc√™ poder√° registrar diferentes motoristas e operadores para cada per√≠odo de trabalho (ex: 07-15h, 15-23h, 23-07h).
                                    </small>
                                </div>
                            </div>
                            
                            <div id="turnoUnicoFields" class="turno-fields">
                                <div class="form-group">
                                    <label class="form-label">Motorista *</label>
                                    <input type="text" id="equipeMotorista" class="form-input" placeholder="Nome do motorista">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Operador(es) *</label>
                                    <textarea id="equipeOperadores" class="form-textarea" placeholder="Nome dos operadores"></textarea>
                                </div>
                            </div>

                            <div id="multiTurnoFields" class="turno-fields hidden">
                                <div style="margin-bottom: 1.5rem; padding: 1rem; background: var(--warning-color); color: white; border-radius: 8px;">
                                    <h5 style="margin-bottom: 0.5rem;">‚ö†Ô∏è Modo M√∫ltiplos Turnos Ativado</h5>
                                    <p style="font-size: 0.875rem; margin: 0;">
                                        Defina os hor√°rios e equipes para cada turno. Clique em "+ Adicionar Turno" para registrar cada per√≠odo de trabalho.
                                    </p>
                                </div>
                                
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h5 style="color: var(--primary-color);">Turnos de Trabalho</h5>
                                    <button type="button" class="btn btn-sm btn-success" onclick="adicionarTurnoTrabalho()">
                                        + Adicionar Turno
                                    </button>
                                </div>
                                
                                <div id="turnosTrabalhoContainer">
                                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                                        Clique em "+ Adicionar Turno" para registrar o primeiro turno de trabalho.
                                    </p>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">√Årea de Atua√ß√£o *</label>
                                <input type="text" id="equipeArea" class="form-input" required placeholder="Ex: Galp√£o X, Linha Y...">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Atividade Principal *</label>
                                <input type="text" id="equipeAtividade" class="form-input" required placeholder="Ex: Limpeza de caixa, Desobstru√ß√£o...">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Tipo de Atividade *</label>
                                <select id="equipeTipoAtividade" class="form-select" required>
                                    <option value="Rotineira">Rotineira</option>
                                    <option value="Emergencial">Emergencial</option>
                                    <option value="Programada">Programada</option>
                                    <option value="Preventiva">Preventiva</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Status da Atividade *</label>
                                <select id="equipeStatusAtividade" class="form-select" required onchange="togglePendencia()">
                                    <option value="Conclu√≠do">Conclu√≠do (100%)</option>
                                    <option value="Em andamento">Em andamento</option>
                                    <option value="N√£o Iniciado">N√£o Iniciado</option>
                                </select>
                            </div>
                            
                            <div class="form-group hidden" id="pendenciaContainer">
                                <label class="form-label">Justificativa/Pend√™ncia *</label>
                                <textarea id="equipePendencia" class="form-textarea" placeholder="Informe o motivo da pend√™ncia ou n√£o in√≠cio"></textarea>
                            </div>

                            <!-- Controle de Atrasos por Equipamento - ATUALIZADO -->
                            <div class="atraso-section">
                                <h5>‚è∞ Controle de Atrasos</h5>
                                <div class="form-group">
                                    <label class="form-label">Houve atraso no direcionamento deste equipamento?</label>
                                    <div style="display: flex; gap: 2rem; margin-top: 0.5rem;">
                                        <div class="form-radio">
                                            <input type="radio" name="houveAtrasoEquipe" id="atrasoEquipeNao" value="N√£o" checked onchange="toggleAtrasoEquipe()">
                                            <label for="atrasoEquipeNao" style="color: white;">N√£o</label>
                                        </div>
                                        <div class="form-radio">
                                            <input type="radio" name="houveAtrasoEquipe" id="atrasoEquipeSim" value="Sim" onchange="toggleAtrasoEquipe()">
                                            <label for="atrasoEquipeSim" style="color: white;">Sim</label>
                                        </div>
                                    </div>
                                </div>

                                <div id="atrasoEquipeDetalhes" class="hidden" style="margin-top: 1rem;">
                                    <div class="form-group">
                                        <label class="form-label">Hor√°rio de direcionamento:</label>
                                        <input type="datetime-local" id="horarioDirecionamento" class="form-input">
                                        <small style="color: rgba(255,255,255,0.8); font-size: 0.8rem;">Informe quando o equipamento foi direcionado para a √°rea</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label class="form-label">Motivo do atraso:</label>
                                        <select id="motivoAtrasoEquipe" class="form-select">
                                            <option value="">Selecione o motivo...</option>
                                            <option value="Falta de acess√≥rio">Falta de acess√≥rio</option>
                                            <option value="Falta de implemento">Falta de implemento</option>
                                            <option value="Falta de operador">Falta de operador</option>
                                            <option value="Falta de EPI">Falta de EPI</option>
                                            <option value="Falta de motorista">Falta de motorista</option>
                                            <option value="Sem programa√ß√£o">Sem programa√ß√£o</option>
                                            <option value="Outros">Outros</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Justificativa do atraso:</label>
                                        <textarea id="justificativaAtrasoEquipe" class="form-textarea" rows="2" placeholder="Descreva detalhadamente o motivo do atraso..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Coluna Direita: Equipamentos e Status -->
                        <div>
                            <h4 style="margin-bottom: 1rem; color: var(--primary-color);">Equipamentos e Status</h4>
                            
                            <div class="form-group">
                                <label class="form-label">Vaga (Parte Di√°ria) *</label>
                                <select id="equipeVaga" class="form-select" required onchange="checkOutroVaga()">
                                    <option value="">Selecione a vaga...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                                <div id="campoOutroVaga" class="campo-outro hidden">
                                    <input type="text" id="equipeVagaOutro" class="form-input" placeholder="Digite a vaga manualmente">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Equipamento *</label>
                                <select id="equipeEquipamento" class="form-select" required onchange="checkOutroEquipamento()">
                                    <option value="">Selecione o equipamento...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                                <div id="campoOutroEquipamento" class="campo-outro hidden">
                                    <input type="text" id="equipeEquipamentoOutro" class="form-input" placeholder="Digite o equipamento manualmente">
                                </div>
                            </div>
                            
                            <!-- Trocas de Equipamento -->
                            <div style="border: 1px solid var(--gray-200); border-radius: 8px; padding: 1.5rem; margin-top: 1.5rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                    <h5 style="color: var(--secondary-color);">Trocas de Equipamento</h5>
                                    <button type="button" class="btn btn-sm btn-success" onclick="adicionarTroca()">+ Adicionar Troca</button>
                                </div>
                                <div id="trocasContainer">
                                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">Nenhuma troca registrada</p>
                                </div>
                            </div>

                            <!-- Implementos -->
                            <div id="implementosSection" class="implementos-section">
                                <h5 style="margin-bottom: 1rem; color: var(--secondary-color);">Implementos e Seguran√ßa</h5>
                                <div id="implementosContainer">
                                    <!-- Preenchido via JavaScript baseado no tipo de equipe -->
                                </div>
                            </div>
                            
                            <!-- Observa√ß√µes -->
                            <div class="form-group" style="margin-top: 1.5rem;">
                                <label class="form-label">Observa√ß√µes Adicionais</label>
                                <textarea id="equipeObservacoes" class="form-textarea" placeholder="Observa√ß√µes gerais sobre a equipe ou atividade"></textarea>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="confirmCloseModal('modalEquipe')">
                    Cancelar
                </button>
                <button type="submit" form="formEquipe" class="btn btn-success">
                    Salvar Equipe
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Visualizar Relat√≥rio -->
    <div class="modal" id="modalVisualizarRelatorio">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h3 class="modal-title">Visualizar Relat√≥rio</h3>
                <button class="modal-close" onclick="closeModal('modalVisualizarRelatorio')">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 1rem; display: flex; gap: 1rem; justify-content: center;">
                    <button class="btn btn-info" onclick="copiarRelatorio()">
                        Copiar Texto
                    </button>
                </div>
                <div class="report-container" id="relatorioTexto">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('modalVisualizarRelatorio')">
                    Fechar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Confirmar Exclus√£o -->
    <div class="modal" id="modalConfirmarExclusao">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title" style="color: var(--danger-color);">‚ö†Ô∏è Excluir Relat√≥rio</h3>
                <button class="modal-close" onclick="closeModal('modalConfirmarExclusao')">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 1rem; color: var(--danger-color); font-weight: 600;">
                    Esta a√ß√£o √© IRREVERS√çVEL!
                </p>
                <p style="margin-bottom: 1.5rem;">
                    Digite a senha de autoriza√ß√£o para excluir este relat√≥rio:
                </p>
                
                <input type="hidden" id="relatorioParaExcluir" value="">
                
                <div class="form-group">
                    <label class="form-label">Senha de Autoriza√ß√£o *</label>
                    <input type="password" id="senhaExclusao" class="form-input" placeholder="Digite a senha">
                    <small style="color: var(--gray-500);">Senha necess√°ria: Apagar@GPS</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('modalConfirmarExclusao')">
                    Cancelar
                </button>
                <button class="btn btn-danger" onclick="confirmarExclusaoRelatorio()">
                    Excluir Relat√≥rio
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text" id="loadingText">Carregando...</div>
        </div>
    </div>

    <script>
        // SISTEMA DE RELAT√ìRIO DE TURNO - GRUPOGPS
        // Sistema profissional com GitHub como banco de dados
        
        // Estado Global da Aplica√ß√£o
        let currentUser = 'GrupoGPS';
        let userLevel = 'admin';
        let relatorios = [];
        let configuracoes = {};
        let systemData = {};
        let currentStep = 1;
        let currentRelatorio = {
            dadosTurno: {},
            equipes: []
        };
        let hasUnsavedChanges = false;
        let currentModalId = null;
        
        // Controles do sistema
        let isOnline = navigator.onLine;
        let autoRefreshTimer = null;
        
        function sanitizeText(text) {
            if (typeof text !== 'string') return text;
            
            // NOVA L√ìGICA: Manter acentua√ß√£o correta do portugu√™s
            let cleaned = text
                // Corrigir apenas codifica√ß√µes problem√°ticas conhecidas
                .replace(/\\x83O/g, '√ÉO')
                .replace(/\\x81/g, '√Å')
                .replace(/\\x83/g, '√É')
                .replace(/√É\x83O/g, '√ÉO')
                .replace(/√É\x81/g, '√Å')
                
                // Remover APENAS caracteres de controle e substitui√ß√£o Unicode inv√°lidos
                .replace(/[\u0000-\u001F\u007F-\u009F]/g, '') // Remove caracteres de controle
                .replace(/\uFFFD/g, '')  // Remove caractere de substitui√ß√£o
                .trim();
            
            return cleaned;
        }

        // FUN√á√ÉO PARA SANITIZAR OBJETOS RECURSIVAMENTE
        function sanitizeObject(obj) {
            if (typeof obj === 'string') {
                return sanitizeText(obj);
            } else if (Array.isArray(obj)) {
                return obj.map(item => sanitizeObject(item));
            } else if (obj && typeof obj === 'object') {
                const cleaned = {};
                for (const [key, value] of Object.entries(obj)) {
                    const cleanKey = sanitizeText(key);
                    cleaned[cleanKey] = sanitizeObject(value);
                }
                return cleaned;
            }
            return obj;
        }
        
        // Configura√ß√£o GitHub
        const GITHUB_CONFIG = {
            owner: 'GrupoGps-Mecanizada',
            repo: 'Relat-rio-Turno---Oficial',
            branch: 'main',
            token: null,
            paths: {
                relatorios: 'data/relatorios.json',
                configuracoes: 'data/configuracoes.json',
                supervisores: 'data/supervisores.json',
                vagas: 'data/vagas.json',
                equipamentos: 'data/equipamentos.json'
            }
        };

        // Dados padr√£o do sistema atualizados
        const DEFAULT_SYSTEM_DATA = {
            supervisores: [
                'Ozias',
                'Israel', 
                'Junior Pereira',
                'Donizete',
                'Sebasti√£o Ribeiro',
                'Jenessi',
                'Wellison',
                'Matuzalem' 
            ],
            vagas: [
                'ALTA PRESS√ÉO - GPS - 01 - 24 HS',
                'ALTA PRESS√ÉO - GPS - 02',
                'ALTA PRESS√ÉO - GPS - 03',
                'ALTA PRESS√ÉO - GPS - 04',
                'ALTA PRESS√ÉO - GPS - 05',
                'ALTA PRESS√ÉO - GPS - 06',
                'ALTA PRESS√ÉO - GPS - 07 - 16 HS',
                'ALTA PRESS√ÉO - GPS - 08 - 24 HS',
                'ALTA PRESS√ÉO - GPS - 09',
                'ALTA PRESS√ÉO - GPS - 10',
                'ALTA PRESS√ÉO - GPS - 11',
                'MOTO BOMBA',
                'ASPIRADOR INDUSTRIAL - GPS - 01',
                'ASPIRADOR INDUSTRIAL - GPS - 02',
                'ASPIRADOR INDUSTRIAL - GPS - 03',
                'ASPIRADOR INDUSTRIAL - GPS - 04',
                'ASPIRADOR INDUSTRIAL - GPS - 05',
                'ASPIRADOR INDUSTRIAL - GPS - 06',
                'ASPIRADOR INDUSTRIAL - GPS - 07',
                'ASPIRADOR INDUSTRIAL - GPS - 08',
                'ASPIRADOR INDUSTRIAL - GPS - 09',
                'ASPIRADOR INDUSTRIAL - GPS - 10',
                'ASPIRADOR INDUSTRIAL - GPS - SPOT',
                'AUTO V√ÅCUO - GPS - 01 - 16 HS',
                'AUTO V√ÅCUO - GPS - 02 - 16 HS',
                'AUTO V√ÅCUO - GPS - 03',
                'AUTO V√ÅCUO - GPS - 04',
                'AUTO V√ÅCUO - GPS - 05',
                'AUTO V√ÅCUO - GPS - 06',
                'AUTO V√ÅCUO - GPS - 07 - 16 HS',
                'AUTO V√ÅCUO - GPS - 08 - 24 HS',
                'CAMINH√ÉO BROOK - GPS - 01',
                'CAMINH√ÉO BROOK - GPS - 02',
                'CAMINH√ÉO BROOK - GPS - 03',
                'HIPER V√ÅCUO - GPS - 01',
                'HIPER V√ÅCUO - GPS - 02'
                'HIPER V√ÅCUO - GPS - 03'
            ],
            equipamentos: {
                'Alta Press√£o': [
                    'EZC-0453', 'DSY-6474', 'DSY-6475', 'EAM-3253', 'EAM-3255', 'EAM-3256', 'EAM-3262',
                    'EGC-2978', 'EGC-2989', 'EGC-2983', 'EGC-2986', 'FLX-7616', 'FLX-7617', 'GVB-2102',
                    'EZS-9784', 'JUX-3201', 'PUB-2502', 'PUB-2780'
                ],
                'Auto V√°cuo': [
                    'ANF-5922', 'ANF-2876', 'CUB-0763', 'DSY-6473', 'DSY-6577', 'DYS-7210', 'EAM-3251',
                    'EAM-3257', 'EGC-2979', 'EGC-2993', 'EGC-3071', 'HDS-1097', 'EZS-9753', 'EZS-9924',
                    'EHD-9264', 'FMD-2200', 'FTD-6358', 'FTW-4999', 'GAJ-1204'
                ],
                'Hiper V√°cuo': [
                    'FMD-2200', 'FHD-9264', 'EZS-9753'
                ]
            }
        };

        // Implementos por tipo de equipamento
        const IMPLEMENTOS_CONFIG = {
            'Alta Pressao': {
                'Pistola': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Pistola C.L.': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Mang. Torpedo': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Pedal': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Varetas': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Rabicho': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Lances Mangueira': { 
                    type: 'select', 
                    options: ['N/A', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', 'Mais de 15'] 
                },
                'Lances Varetas': { 
                    type: 'select', 
                    options: ['N/A', '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', 'Mais de 15'] 
                }
            },
            'Auto Vacuo / Hiper Vacuo': {
                'Mangotes': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Redu√ß√µes': { type: 'select', options: ['N/A', 'OK', 'Falta'] },
                'Mangotes 3"': { 
                    type: 'select', 
                    options: ['N/A', '10 metros', '20 metros', '30 metros', '40 metros', '50 metros', 
                             '60 metros', '70 metros', '80 metros', '90 metros', '100 metros', 'Mais de 100 metros'] 
                },
                'Mangotes 4"': { 
                    type: 'select', 
                    options: ['N/A', '10 metros', '20 metros', '30 metros', '40 metros', '50 metros', 
                             '60 metros', '70 metros', '80 metros', '90 metros', '100 metros', 'Mais de 100 metros'] 
                },
                'Mangotes 6"': { 
                    type: 'select', 
                    options: ['N/A', '10 metros', '20 metros', '30 metros', '40 metros', '50 metros', 
                             '60 metros', '70 metros', '80 metros', '90 metros', '100 metros', 'Mais de 100 metros'] 
                }
            }
        };

        // INICIALIZA√á√ÉO DO SISTEMA
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ Sistema de Relat√≥rio de Turno - GrupoGPS');
            console.log('üîß Sistema refinado e otimizado');
            
            // Carregar dados do backup local primeiro
            loadLocalBackup();
            
            // Verificar token de configura√ß√£o
            const savedToken = localStorage.getItem('grupogps_relatorio_githubToken');
            if (savedToken) {
                GITHUB_CONFIG.token = savedToken;
                
                try {
                    await loadAllDataFromGitHub();
                    initializeInterface();
                    startAutoRefresh();
                } catch (error) {
                    console.error('Erro ao carregar dados do GitHub:', error);
                    showNotification('Usando dados locais. Verifique o token do GitHub.', 'warning');
                    // Continuar com dados locais se houver
                    initializeInterface();
                    // Mostrar modo setup
                    if (relatorios.length === 0) {
                        document.getElementById('setupInstruction').classList.remove('hidden');
                        document.getElementById('btnInitializeSystem').classList.remove('hidden');
                    }
                }
            } else {
                // Mostrar modo setup
                showNotification('Configure o token do GitHub para come√ßar.', 'info');
                switchTab('configuracoes');
                document.getElementById('setupInstruction').classList.remove('hidden');
                document.getElementById('btnInitializeSystem').classList.remove('hidden');
                
                // Ainda assim inicializar a interface com dados locais se houver
                initializeInterface();
            }

            // Configurar event listeners
            setupEventListeners();
            
            // Configurar data padr√£o
            setupDefaultDate();
            
            // Monitoramento de conectividade
            setupNetworkMonitoring();

            // Carregar dados padr√£o nos selects
            loadDefaultData();
        });

        function loadLocalBackup() {
            try {
                const backup = localStorage.getItem('grupogps_relatorio_backup');
                if (backup) {
                    let backupData = JSON.parse(backup);
                    
                    // SANITIZAR DADOS DO BACKUP LOCAL
                    backupData = sanitizeObject(backupData);
                    
                    if (Array.isArray(backupData) && backupData.length > 0) {
                        relatorios = backupData;
                        console.log('üì¶ Dados carregados e sanitizados do backup local:', relatorios.length, 'relat√≥rios');
                        updateInterface();
                    }
                }
            } catch (error) {
                console.error('Erro ao carregar backup local:', error);
            }
        }

        function loadDefaultData() {
            // Carregar supervisores
            const supervisorSelect = document.getElementById('supervisorTurno');
            supervisorSelect.innerHTML = '<option value="">Selecione o supervisor...</option>';
            DEFAULT_SYSTEM_DATA.supervisores.forEach(supervisor => {
                supervisorSelect.innerHTML += `<option value="${supervisor}">${supervisor}</option>`;
            });
        }

        function setupEventListeners() {
            // Fechar modais ao clicar fora - COM CONFIRMA√á√ÉO
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    confirmCloseModal(e.target.id);
                }
            });

            // Atalhos de teclado - COM CONFIRMA√á√ÉO
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal.show').forEach(modal => {
                        confirmCloseModal(modal.id);
                    });
                }
            });
        }

        function setupDefaultDate() {
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('dataTurno').value = hoje;
        }

        function setupNetworkMonitoring() {
            window.addEventListener('online', () => {
                isOnline = true;
                updateSyncStatus('success', 'Conectado');
                showNotification('Conex√£o restaurada! Sincronizando dados...', 'success');
                if (GITHUB_CONFIG.token) {
                    loadAllDataFromGitHub();
                }
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateSyncStatus('error', 'Offline');
                showNotification('Sem conex√£o. Trabalhando offline.', 'warning');
            });
        }

        function toggleAtrasoEquipe() {
            const houveAtraso = document.querySelector('input[name="houveAtrasoEquipe"]:checked').value;
            const detalhes = document.getElementById('atrasoEquipeDetalhes');
            
            if (houveAtraso === 'Sim') {
                detalhes.classList.remove('hidden');
                // Configurar data/hora padr√£o como agora
                const agora = new Date();
                const dataHoraLocal = agora.toISOString().slice(0, 16);
                document.getElementById('horarioDirecionamento').value = dataHoraLocal;
            } else {
                detalhes.classList.add('hidden');
                document.getElementById('horarioDirecionamento').value = '';
                document.getElementById('motivoAtrasoEquipe').value = '';
                document.getElementById('justificativaAtrasoEquipe').value = '';
            }
        }

        function checkOutroVaga() {
            const select = document.getElementById('equipeVaga');
            const campoOutro = document.getElementById('campoOutroVaga');
            
            if (select.value === 'Outro') {
                campoOutro.classList.remove('hidden');
                document.getElementById('equipeVagaOutro').required = true;
            } else {
                campoOutro.classList.add('hidden');
                document.getElementById('equipeVagaOutro').required = false;
                document.getElementById('equipeVagaOutro').value = '';
            }
        }

        function checkOutroEquipamento() {
            const select = document.getElementById('equipeEquipamento');
            const campoOutro = document.getElementById('campoOutroEquipamento');
            
            if (select.value === 'Outro') {
                campoOutro.classList.remove('hidden');
                document.getElementById('equipeEquipamentoOutro').required = true;
            } else {
                campoOutro.classList.add('hidden');
                document.getElementById('equipeEquipamentoOutro').required = false;
                document.getElementById('equipeEquipamentoOutro').value = '';
            }
        }
        
        // --- IN√çCIO: Fun√ß√µes da Implementa√ß√£o ---

        // 1. Fun√ß√µes do Teste de Etil√¥metro
        function toggleEtilometroAusencias() {
            const etilometroRealizado = document.querySelector('input[name="etilometroRealizado"]:checked').value;
            const container = document.getElementById('etilometroAusenciasContainer');
            
            if (etilometroRealizado === 'N√£o') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
                // Limpar lista de aus√™ncias se todos realizaram
                document.getElementById('listaAusenciasEtilometro').innerHTML = `
                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                        Nenhuma aus√™ncia registrada. Se houver aus√™ncias, clique em "Adicionar Colaborador".
                    </p>
                `;
            }
        }

        function adicionarAusenciaEtilometro() {
            const lista = document.getElementById('listaAusenciasEtilometro');
            
            if (lista.innerHTML.includes('Nenhuma aus√™ncia')) {
                lista.innerHTML = '';
            }
            
            const index = lista.children.length;
            const ausenciaHtml = `
                <div class="troca-item" id="ausenciaEtilometro_${index}" style="background: white;">
                    <div class="troca-header">
                        <h6 class="troca-title">Colaborador ${index + 1}</h6>
                        <button type="button" class="btn-remove-troca" onclick="removerAusenciaEtilometro(${index})">Remover</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Nome do Colaborador *</label>
                            <input type="text" name="ausenciaEtilometro_nome_${index}" class="form-input" required placeholder="Nome completo">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Motivo da Aus√™ncia *</label>
                            <select name="ausenciaEtilometro_motivo_${index}" class="form-select" required>
                                <option value="">Selecione o motivo...</option>
                                <option value="Afastamento M√©dico">Afastamento M√©dico</option>
                                <option value="Atestado">Atestado</option>
                                <option value="Falta Justificada">Falta Justificada</option>
                                <option value="Falta N√£o Justificada">Falta N√£o Justificada</option>
                                <option value="F√©rias">F√©rias</option>
                                <option value="Chegou Ap√≥s Teste">Chegou Ap√≥s o Teste</option>
                                <option value="Recusou Realizar">Recusou Realizar o Teste</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes Adicionais</label>
                        <textarea name="ausenciaEtilometro_obs_${index}" class="form-textarea" rows="2" placeholder="Detalhes adicionais sobre a aus√™ncia..."></textarea>
                    </div>
                </div>
            `;
            
            lista.innerHTML += ausenciaHtml;
        }

        function removerAusenciaEtilometro(index) {
            const ausenciaElement = document.getElementById(`ausenciaEtilometro_${index}`);
            if (ausenciaElement) {
                ausenciaElement.remove();
                
                const lista = document.getElementById('listaAusenciasEtilometro');
                if (lista.children.length === 0) {
                    lista.innerHTML = `
                        <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                            Nenhuma aus√™ncia registrada. Se houver aus√™ncias, clique em "Adicionar Colaborador".
                        </p>
                    `;
                }
            }
        }

        function coletarDadosEtilometro() {
            const etilometroRealizado = document.querySelector('input[name="etilometroRealizado"]:checked').value;
            const horario = document.getElementById('horarioEtilometro').value;
            const observacoes = document.getElementById('observacoesEtilometro').value;
            
            const dadosEtilometro = {
                realizado: etilometroRealizado === 'Sim',
                horarioTeste: horario,
                responsavel: document.getElementById('supervisorTurno').value,
                observacoes: observacoes,
                colaboradoresAusentes: []
            };
            
            if (etilometroRealizado === 'N√£o') {
                const lista = document.getElementById('listaAusenciasEtilometro');
                const ausencias = lista.querySelectorAll('.troca-item');
                
                ausencias.forEach((item, index) => {
                    const nome = item.querySelector(`[name="ausenciaEtilometro_nome_${index}"]`)?.value;
                    const motivo = item.querySelector(`[name="ausenciaEtilometro_motivo_${index}"]`)?.value;
                    const obs = item.querySelector(`[name="ausenciaEtilometro_obs_${index}"]`)?.value;
                    
                    if (nome && motivo) {
                        dadosEtilometro.colaboradoresAusentes.push({
                            nome: nome,
                            motivo: motivo,
                            observacao: obs
                        });
                    }
                });
            }
            
            return dadosEtilometro;
        }

        // 2. Fun√ß√µes de Gest√£o de Faltas
        function toggleFaltasContainer() {
            const houveFaltas = document.querySelector('input[name="houveFaltas"]:checked').value;
            const container = document.getElementById('faltasContainer');
            
            if (houveFaltas === 'Sim') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
                document.getElementById('listaFaltas').innerHTML = `
                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                        Nenhuma falta registrada. Clique em "Registrar Falta" para adicionar.
                    </p>
                `;
            }
        }

        function adicionarFalta() {
            const lista = document.getElementById('listaFaltas');
            
            if (lista.innerHTML.includes('Nenhuma falta')) {
                lista.innerHTML = '';
            }
            
            const index = lista.children.length;
            const faltaHtml = `
                <div class="troca-item" id="falta_${index}" style="background: white; border-left: 4px solid var(--danger-color);">
                    <div class="troca-header">
                        <h6 class="troca-title">Falta ${index + 1}</h6>
                        <button type="button" class="btn-remove-troca" onclick="removerFalta(${index})">Remover</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Nome do Colaborador *</label>
                            <input type="text" name="falta_nome_${index}" class="form-input" required placeholder="Nome completo do colaborador">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Fun√ß√£o/Cargo *</label>
                            <select name="falta_funcao_${index}" class="form-select" required>
                                <option value="">Selecione a fun√ß√£o...</option>
                                <option value="Motorista">Motorista</option>
                                <option value="Operador">Operador</option>
                                <option value="Auxiliar">Auxiliar</option>
                                <option value="Supervisor">Supervisor</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Motivo da Falta *</label>
                            <select name="falta_motivo_${index}" class="form-select" required>
                                <option value="">Selecione o motivo...</option>
                                <option value="Atestado M√©dico">Atestado M√©dico</option>
                                <option value="Doen√ßa">Doen√ßa</option>
                                <option value="Quest√µes Familiares">Quest√µes Familiares</option>
                                <option value="Acidente">Acidente</option>
                                <option value="Problemas Pessoais">Problemas Pessoais</option>
                                <option value="Falta N√£o Justificada">Falta N√£o Justificada</option>
                                <option value="F√©rias">F√©rias</option>
                                <option value="Licen√ßa">Licen√ßa</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Falta Justificada? *</label>
                            <div style="display: flex; gap: 2rem; margin-top: 0.5rem;">
                                <div class="form-radio">
                                    <input type="radio" name="falta_justificada_${index}" value="Sim" checked>
                                    <label>Sim</label>
                                </div>
                                <div class="form-radio">
                                    <input type="radio" name="falta_justificada_${index}" value="N√£o">
                                    <label>N√£o</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--info-color); color: white; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                        <div class="form-group">
                            <label class="form-label" style="color: white;">Houve substitui√ß√£o deste colaborador? *</label>
                            <div style="display: flex; gap: 2rem; margin-top: 0.5rem;">
                                <div class="form-radio">
                                    <input type="radio" name="falta_substituicao_${index}" value="Sim" onchange="toggleSubstituto(${index})">
                                    <label style="color: white;">Sim</label>
                                </div>
                                <div class="form-radio">
                                    <input type="radio" name="falta_substituicao_${index}" value="N√£o" checked onchange="toggleSubstituto(${index})">
                                    <label style="color: white;">N√£o</label>
                                </div>
                            </div>
                        </div>
                        
                        <div id="substitutoContainer_${index}" class="hidden" style="margin-top: 1rem;">
                            <div class="form-group">
                                <label class="form-label" style="color: white;">Nome do Substituto *</label>
                                <input type="text" name="falta_substituto_${index}" class="form-input" placeholder="Nome completo do substituto">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes Adicionais</label>
                        <textarea name="falta_observacoes_${index}" class="form-textarea" rows="2" placeholder="Detalhes adicionais sobre a falta ou substitui√ß√£o..."></textarea>
                    </div>
                </div>
            `;
            
            lista.innerHTML += faltaHtml;
        }

        function removerFalta(index) {
            const faltaElement = document.getElementById(`falta_${index}`);
            if (faltaElement) {
                faltaElement.remove();
                
                const lista = document.getElementById('listaFaltas');
                if (lista.children.length === 0) {
                    lista.innerHTML = `
                        <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                            Nenhuma falta registrada. Clique em "Registrar Falta" para adicionar.
                        </p>
                    `;
                }
            }
        }

        function toggleSubstituto(index) {
            const houveSubstituicao = document.querySelector(`input[name="falta_substituicao_${index}"]:checked`).value;
            const container = document.getElementById(`substitutoContainer_${index}`);
            
            if (houveSubstituicao === 'Sim') {
                container.classList.remove('hidden');
                container.querySelector('input').required = true;
            } else {
                container.classList.add('hidden');
                container.querySelector('input').required = false;
                container.querySelector('input').value = '';
            }
        }

        function coletarDadosFaltas() {
            const houveFaltas = document.querySelector('input[name="houveFaltas"]:checked').value;
            
            const dadosFaltas = {
                houveFaltas: houveFaltas === 'Sim',
                faltas: []
            };
            
            if (houveFaltas === 'Sim') {
                const lista = document.getElementById('listaFaltas');
                const faltas = lista.querySelectorAll('.troca-item');
                
                faltas.forEach((item, index) => {
                    const nome = item.querySelector(`[name="falta_nome_${index}"]`)?.value;
                    const funcao = item.querySelector(`[name="falta_funcao_${index}"]`)?.value;
                    const motivo = item.querySelector(`[name="falta_motivo_${index}"]`)?.value;
                    const justificada = item.querySelector(`input[name="falta_justificada_${index}"]:checked`)?.value;
                    const houveSubstituicao = item.querySelector(`input[name="falta_substituicao_${index}"]:checked`)?.value;
                    const substituto = item.querySelector(`[name="falta_substituto_${index}"]`)?.value;
                    const observacoes = item.querySelector(`[name="falta_observacoes_${index}"]`)?.value;
                    
                    if (nome && funcao && motivo) {
                        dadosFaltas.faltas.push({
                            nomeColaborador: nome,
                            funcao: funcao,
                            motivo: motivo,
                            justificada: justificada === 'Sim',
                            houveSubstituicao: houveSubstituicao === 'Sim',
                            nomeSubstituto: substituto || null,
                            observacoes: observacoes
                        });
                    }
                });
            }
            
            return dadosFaltas;
        }

        // 3. Fun√ß√µes de M√∫ltiplos Turnos
        function toggleRegimeTurno() {
            const regime = document.querySelector('input[name="regimeTrabalho"]:checked').value;
            const turnoUnicoFields = document.getElementById('turnoUnicoFields');
            const multiTurnoFields = document.getElementById('multiTurnoFields');
            const infoMultiTurno = document.getElementById('infoMultiTurno');
            
            if (regime === 'turno-unico') {
                turnoUnicoFields.classList.remove('hidden');
                multiTurnoFields.classList.add('hidden');
                infoMultiTurno.classList.add('hidden');
                
                document.getElementById('turnosTrabalhoContainer').innerHTML = `
                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                        Clique em "+ Adicionar Turno" para registrar o primeiro turno de trabalho.
                    </p>
                `;
            } else {
                turnoUnicoFields.classList.add('hidden');
                multiTurnoFields.classList.remove('hidden');
                infoMultiTurno.classList.remove('hidden');
                
                document.getElementById('equipeMotorista').value = '';
                document.getElementById('equipeOperadores').value = '';
            }
        }

        function adicionarTurnoTrabalho() {
            const container = document.getElementById('turnosTrabalhoContainer');
            
            if (container.innerHTML.includes('Clique em')) {
                container.innerHTML = '';
            }
            
            const index = container.children.length;
            
            const horariosComuns = [
                { inicio: '07:00', fim: '15:00', label: '07:00 - 15:00 (Turno Manh√£)' },
                { inicio: '15:00', fim: '23:00', label: '15:00 - 23:00 (Turno Tarde)' },
                { inicio: '23:00', fim: '07:00', label: '23:00 - 07:00 (Turno Noite)' },
                { inicio: '07:00', fim: '19:00', label: '07:00 - 19:00 (Turno 12h Dia)' },
                { inicio: '19:00', fim: '07:00', label: '19:00 - 07:00 (Turno 12h Noite)' }
            ];
            
            const turnoHtml = `
                <div class="troca-item" id="turnoTrabalho_${index}" style="background: white; border-left: 4px solid var(--primary-color);">
                    <div class="troca-header">
                        <h6 class="troca-title">‚è∞ Turno ${index + 1}</h6>
                        <button type="button" class="btn-remove-troca" onclick="removerTurnoTrabalho(${index})">Remover</button>
                    </div>
                    
                    <div style="background: var(--gray-50); padding: 1rem; border-radius: 6px; margin-bottom: 1rem;">
                        <div class="form-group" style="margin-bottom: 1rem;">
                            <label class="form-label">Per√≠odo Pr√©-definido (opcional)</label>
                            <select class="form-select" onchange="preencherHorarioTurno(${index}, this.value)">
                                <option value="">Selecione um per√≠odo comum ou preencha manualmente...</option>
                                ${horariosComuns.map((h, i) => `
                                    <option value="${i}">${h.label}</option>
                                `).join('')}
                                <option value="custom">Personalizado (preencher manualmente)</option>
                            </select>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Hor√°rio In√≠cio *</label>
                                <input type="time" name="turno_inicio_${index}" class="form-input" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Hor√°rio Fim *</label>
                                <input type="time" name="turno_fim_${index}" class="form-input" required>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Motorista do Turno *</label>
                            <input type="text" name="turno_motorista_${index}" class="form-input" required placeholder="Nome do motorista deste turno">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Operador(es) do Turno *</label>
                            <textarea name="turno_operadores_${index}" class="form-textarea" required placeholder="Nome dos operadores deste turno" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes deste Turno</label>
                        <textarea name="turno_observacoes_${index}" class="form-textarea" rows="2" placeholder="Observa√ß√µes espec√≠ficas deste per√≠odo..."></textarea>
                    </div>
                </div>
            `;
            
            container.innerHTML += turnoHtml;
        }

        function preencherHorarioTurno(index, optionValue) {
            if (!optionValue || optionValue === 'custom') return;
            
            const horariosComuns = [
                { inicio: '07:00', fim: '15:00' },
                { inicio: '15:00', fim: '23:00' },
                { inicio: '23:00', fim: '07:00' },
                { inicio: '07:00', fim: '19:00' },
                { inicio: '19:00', fim: '07:00' }
            ];
            
            const horario = horariosComuns[parseInt(optionValue)];
            if (horario) {
                document.querySelector(`[name="turno_inicio_${index}"]`).value = horario.inicio;
                document.querySelector(`[name="turno_fim_${index}"]`).value = horario.fim;
            }
        }

        function removerTurnoTrabalho(index) {
            const turnoElement = document.getElementById(`turnoTrabalho_${index}`);
            if (turnoElement) {
                turnoElement.remove();
                
                const container = document.getElementById('turnosTrabalhoContainer');
                if (container.children.length === 0) {
                    container.innerHTML = `
                        <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                            Clique em "+ Adicionar Turno" para registrar o primeiro turno de trabalho.
                        </p>
                    `;
                }
            }
        }
        
        // 4. Fun√ß√µes de Equipamentos Devendo
        function toggleEquipamentosDevendo() {
            const ficouDevendo = document.querySelector('input[name="equipamentosDevendo"]:checked').value;
            const container = document.getElementById('equipamentosDevendoContainer');
            
            if (ficouDevendo === 'Sim') {
                container.classList.remove('hidden');
            } else {
                container.classList.add('hidden');
                document.getElementById('listaEquipamentosDevendo').innerHTML = `
                    <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                        Nenhum equipamento registrado. Clique em "+ Adicionar Equipamento".
                    </p>
                `;
            }
        }

        function adicionarEquipamentoDevendo() {
            const lista = document.getElementById('listaEquipamentosDevendo');
            
            if (lista.innerHTML.includes('Nenhum equipamento')) {
                lista.innerHTML = '';
            }
            
            const index = lista.children.length;
            const equipamentoHtml = `
                <div class="troca-item" id="equipamentoDevendo_${index}" style="background: white; border-left: 4px solid var(--danger-color);">
                    <div class="troca-header">
                        <h6 class="troca-title">Equipamento ${index + 1}</h6>
                        <button type="button" class="btn-remove-troca" onclick="removerEquipamentoDevendo(${index})">Remover</button>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Vaga/Equipamento *</label>
                            <select name="equipamentoDevendo_vaga_${index}" class="form-select" required>
                                <option value="">Selecione a vaga...</option>
                                ${(systemData.vagas || DEFAULT_SYSTEM_DATA.vagas).map(vaga => 
                                    `<option value="${sanitizeText(vaga)}">${sanitizeText(vaga)}</option>`
                                ).join('')}
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Motivo *</label>
                            <select name="equipamentoDevendo_motivo_${index}" class="form-select" required>
                                <option value="">Selecione o motivo...</option>
                                <option value="Falta de Equipamento">Falta de Equipamento</option>
                                <option value="Falta de M√£o de Obra">Falta de M√£o de Obra</option>
                                <option value="Equipamento em Manuten√ß√£o">Equipamento em Manuten√ß√£o</option>
                                <option value="Falta de Motorista">Falta de Motorista</option>
                                <option value="Falta de Operador">Falta de Operador</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Observa√ß√µes/Detalhes *</label>
                        <textarea name="equipamentoDevendo_obs_${index}" class="form-textarea" required rows="2" placeholder="Detalhe o que faltou e outras informa√ß√µes relevantes..."></textarea>
                    </div>
                </div>
            `;
            
            lista.innerHTML += equipamentoHtml;
        }

        function removerEquipamentoDevendo(index) {
            const elemento = document.getElementById(`equipamentoDevendo_${index}`);
            if (elemento) {
                elemento.remove();
                
                const lista = document.getElementById('listaEquipamentosDevendo');
                if (lista.children.length === 0) {
                    lista.innerHTML = `
                        <p style="color: var(--gray-500); text-align: center; font-style: italic;">
                            Nenhum equipamento registrado. Clique em "+ Adicionar Equipamento".
                        </p>
                    `;
                }
            }
        }

        function coletarDadosEquipamentosDevendo() {
            const ficouDevendo = document.querySelector('input[name="equipamentosDevendo"]:checked').value;
            
            const dadosDevendo = {
                ficouDevendo: ficouDevendo === 'Sim',
                equipamentos: []
            };
            
            if (ficouDevendo === 'Sim') {
                const lista = document.getElementById('listaEquipamentosDevendo');
                const equipamentos = lista.querySelectorAll('.troca-item');
                
                equipamentos.forEach((item, index) => {
                    const vaga = item.querySelector(`[name="equipamentoDevendo_vaga_${index}"]`)?.value;
                    const motivo = item.querySelector(`[name="equipamentoDevendo_motivo_${index}"]`)?.value;
                    const obs = item.querySelector(`[name="equipamentoDevendo_obs_${index}"]`)?.value;
                    
                    if (vaga && motivo && obs) {
                        dadosDevendo.equipamentos.push({
                            vaga: vaga,
                            motivo: motivo,
                            observacoes: obs
                        });
                    }
                });
            }
            
            return dadosDevendo;
        }
        
        // --- FIM: Fun√ß√µes da Implementa√ß√£o ---

        // CARREGAMENTO DE DADOS
        async function loadAllDataFromGitHub() {
            if (!GITHUB_CONFIG.token) {
                throw new Error('Token do GitHub n√£o configurado');
            }
            
            updateSyncStatus('loading', 'Carregando dados...');
            
            try {
                const [
                    relatoriosData,
                    configuracoesData,
                    supervisoresData,
                    vagasData,
                    equipamentosData
                ] = await Promise.all([
                    getDataFromGitHub('relatorios'),
                    getDataFromGitHub('configuracoes'),
                    getDataFromGitHub('supervisores'),
                    getDataFromGitHub('vagas'),
                    getDataFromGitHub('equipamentos')
                ]);
                
                if (relatoriosData === null || relatoriosData === undefined) {
                    relatorios = [];
                } else if (Array.isArray(relatoriosData)) {
                    relatorios = relatoriosData;
                } else if (typeof relatoriosData === 'object') {
                    if (Array.isArray(relatoriosData.data)) {
                        relatorios = relatoriosData.data;
                    } else if (relatoriosData._lastUpdate && Array.isArray(relatoriosData.relatorios)) {
                        relatorios = relatoriosData.relatorios;
                    } else {
                        const possibleArrays = Object.values(relatoriosData).filter(val => Array.isArray(val));
                        relatorios = possibleArrays.length > 0 ? possibleArrays[0] : [];
                    }
                } else {
                    relatorios = [];
                }
                
                if (!Array.isArray(relatorios)) {
                    relatorios = [];
                }
                
                relatorios = sanitizeObject(relatorios);
                configuracoes = sanitizeObject(configuracoes || {});
                
                let systemDataTemp = {
                    supervisores: supervisoresData || DEFAULT_SYSTEM_DATA.supervisores,
                    vagas: vagasData || DEFAULT_SYSTEM_DATA.vagas,
                    equipamentos: equipamentosData || DEFAULT_SYSTEM_DATA.equipamentos
                };
                
                systemDataTemp = sanitizeObject(systemDataTemp);
                
                if (systemDataTemp.vagas && systemDataTemp.vagas.length > 0 && (systemDataTemp.vagas[0].includes('\\x') || systemDataTemp.vagas[0].includes('√É'))) {
                    systemDataTemp = sanitizeObject(DEFAULT_SYSTEM_DATA);
                }
                
                systemData = systemDataTemp;
                
                updateSyncStatus('success', 'Dados atualizados');
                updateInterface();
                
            } catch (error) {
                updateSyncStatus('error', 'Erro ao carregar');
                console.error('Erro ao carregar dados:', error);
                throw error;
            }
        }

        async function getDataFromGitHub(dataType) {
            const path = GITHUB_CONFIG.paths[dataType];
            
            try {
                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    headers: { 
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json' 
                    }
                });

                if (response.ok) {
                    const fileData = await response.json();
                    const content = atob(fileData.content);
                    let parsedData = JSON.parse(content);
                    parsedData = sanitizeObject(parsedData);
                    return parsedData;
                } else if (response.status === 404) {
                    console.warn(`Arquivo ${path} n√£o encontrado. Ser√° criado na pr√≥xima salva√ß√£o.`);
                    return null;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error(`Erro ao buscar ${dataType}:`, error);
                return null;
            }
        }

        async function saveDataToGitHub(dataType, data) {
            if (!GITHUB_CONFIG.token || !isOnline) {
                throw new Error('Sem conex√£o ou token n√£o configurado');
            }
            
            const path = GITHUB_CONFIG.paths[dataType];
            
            try {
                let sha = null;
                const getResponse = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}`, 'Accept': 'application/vnd.github.v3+json' }
                });

                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }

                let dataToSave = (dataType === 'relatorios') ? sanitizeObject(data) : { ...sanitizeObject(data), _lastUpdate: new Date().toISOString(), _updatedBy: currentUser };

                const jsonContent = JSON.stringify(dataToSave, null, 2);
                const encoder = new TextEncoder();
                const utf8Bytes = encoder.encode(jsonContent);
                let binary = '';
                utf8Bytes.forEach(byte => binary += String.fromCharCode(byte));
                const base64Content = btoa(binary);
                
                const body = {
                    message: `${sha ? 'Atualizar' : 'Criar'} ${dataType} - ${new Date().toLocaleString('pt-BR')}`,
                    content: base64Content,
                    branch: GITHUB_CONFIG.branch
                };
                
                if (sha) body.sha = sha;

                const response = await fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: { 'Authorization': `token ${GITHUB_CONFIG.token}`, 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ message: response.statusText }));
                    throw new Error(`Erro ${response.status}: ${errorData.message}`);
                }
                
                return await response.json();

            } catch (error) {
                console.error(`Erro ao salvar ${dataType}:`, error);
                throw error;
            }
        }

        // NAVEGA√á√ÉO ENTRE ETAPAS
        function nextStep() {
            if (currentStep === 1) {
                if (validateStep1()) {
                    saveStepData(1);
                    showStep(2);
                }
            } else if (currentStep === 2) {
                if (validateStep2()) {
                    showStep(3);
                    generateReview();
                }
            }
        }

        function prevStep() {
            if (currentStep === 2) {
                showStep(1);
            } else if (currentStep === 3) {
                showStep(2);
            }
        }

        function showStep(step) {
            document.querySelectorAll('.step-content').forEach(content => content.style.display = 'none');
            document.getElementById(`etapa${step}`).style.display = 'block';
            updateStepIndicator(step);
            currentStep = step;
        }

        function updateStepIndicator(step) {
            document.querySelectorAll('.step-item').forEach((item, index) => {
                item.classList.remove('active', 'completed');
                if (index + 1 < step) item.classList.add('completed');
                else if (index + 1 === step) item.classList.add('active');
            });
        }

        function validateStep1() {
            const data = document.getElementById('dataTurno').value;
            const horario = document.getElementById('horarioTurno').value;
            const letra = document.getElementById('letraTurno').value;
            const supervisor = document.getElementById('supervisorTurno').value;
            const horarioEtilometro = document.getElementById('horarioEtilometro')?.value;
            
            if (!data || !horario || !letra || !supervisor) {
                showNotification('‚ö†Ô∏è Preencha todos os campos obrigat√≥rios b√°sicos!', 'error');
                return false;
            }
            if (!horarioEtilometro) {
                showNotification('‚ö†Ô∏è Informe o hor√°rio do teste de etil√¥metro!', 'error');
                return false;
            }

            const etilometroRealizado = document.querySelector('input[name="etilometroRealizado"]:checked').value;
            if (etilometroRealizado === 'N√£o') {
                const ausencias = document.getElementById('listaAusenciasEtilometro').querySelectorAll('.troca-item');
                if (ausencias.length === 0) {
                    showNotification('‚ö†Ô∏è Voc√™ indicou que nem todos realizaram o teste de etil√¥metro.\n\nPor favor, registre QUAIS colaboradores n√£o realizaram clicando em "+ Adicionar Colaborador".', 'error');
                    return false;
                }
                let camposIncompletos = [];
                ausencias.forEach((item, index) => {
                    if (!item.querySelector(`[name="ausenciaEtilometro_nome_${index}"]`)?.value?.trim()) camposIncompletos.push(`Aus√™ncia ${index + 1}: Nome n√£o informado`);
                    if (!item.querySelector(`[name="ausenciaEtilometro_motivo_${index}"]`)?.value) camposIncompletos.push(`Aus√™ncia ${index + 1}: Motivo n√£o selecionado`);
                });
                if (camposIncompletos.length > 0) {
                    showNotification('‚ö†Ô∏è Campos incompletos no teste de etil√¥metro:\n\n' + camposIncompletos.join('\n'), 'error');
                    return false;
                }
            }

            const houveFaltas = document.querySelector('input[name="houveFaltas"]:checked').value;
            if (houveFaltas === 'Sim') {
                const faltas = document.getElementById('listaFaltas').querySelectorAll('.troca-item');
                if (faltas.length === 0) {
                    showNotification('‚ö†Ô∏è Voc√™ indicou que houve faltas de colaboradores.\n\nPor favor, registre AS FALTAS clicando em "+ Registrar Falta".', 'error');
                    return false;
                }
                let camposIncompletos = [];
                faltas.forEach((item, index) => {
                    if (!item.querySelector(`[name="falta_nome_${index}"]`)?.value?.trim()) camposIncompletos.push(`Falta ${index + 1}: Nome do colaborador n√£o informado`);
                    if (!item.querySelector(`[name="falta_funcao_${index}"]`)?.value) camposIncompletos.push(`Falta ${index + 1}: Fun√ß√£o n√£o selecionada`);
                    if (!item.querySelector(`[name="falta_motivo_${index}"]`)?.value) camposIncompletos.push(`Falta ${index + 1}: Motivo n√£o selecionado`);
                    if (item.querySelector(`input[name="falta_substituicao_${index}"]:checked`)?.value === 'Sim' && !item.querySelector(`[name="falta_substituto_${index}"]`)?.value?.trim()) {
                        camposIncompletos.push(`Falta ${index + 1}: Nome do substituto n√£o informado`);
                    }
                });
                if (camposIncompletos.length > 0) {
                    showNotification('‚ö†Ô∏è Campos incompletos nas faltas:\n\n' + camposIncompletos.join('\n'), 'error');
                    return false;
                }
            }
            
            const ficouDevendo = document.querySelector('input[name="equipamentosDevendo"]:checked').value;
            if (ficouDevendo === 'Sim') {
                const equipamentos = document.getElementById('listaEquipamentosDevendo').querySelectorAll('.troca-item');
                if (equipamentos.length === 0) {
                    showNotification('‚ö†Ô∏è Voc√™ indicou que ficaram equipamentos devendo.\n\nPor favor, registre OS EQUIPAMENTOS clicando em "+ Adicionar Equipamento".', 'error');
                    return false;
                }
                let camposIncompletos = [];
                equipamentos.forEach((item, index) => {
                    if (!item.querySelector(`[name="equipamentoDevendo_vaga_${index}"]`)?.value) camposIncompletos.push(`Equipamento ${index + 1}: Vaga n√£o selecionada`);
                    if (!item.querySelector(`[name="equipamentoDevendo_motivo_${index}"]`)?.value) camposIncompletos.push(`Equipamento ${index + 1}: Motivo n√£o selecionado`);
                    if (!item.querySelector(`[name="equipamentoDevendo_obs_${index}"]`)?.value?.trim()) camposIncompletos.push(`Equipamento ${index + 1}: Observa√ß√µes n√£o preenchidas`);
                });
                if (camposIncompletos.length > 0) {
                    showNotification('‚ö†Ô∏è Campos incompletos em equipamentos devendo:\n\n' + camposIncompletos.join('\n'), 'error');
                    return false;
                }
            }

            return true;
        }

        function validateStep2() {
            if (currentRelatorio.equipes.length === 0) {
                showNotification('Adicione pelo menos uma equipe!', 'warning');
                return false;
            }
            return true;
        }

        function saveStepData(step) {
            if (step === 1) {
                currentRelatorio.dadosTurno = {
                    data: document.getElementById('dataTurno').value,
                    horario: document.getElementById('horarioTurno').value,
                    letra: document.getElementById('letraTurno').value,
                    supervisor: document.getElementById('supervisorTurno').value
                };
                currentRelatorio.testeEtilometro = coletarDadosEtilometro();
                currentRelatorio.faltasColaboradores = coletarDadosFaltas();
                currentRelatorio.equipamentosDevendo = coletarDadosEquipamentosDevendo();
            }
        }

        // GEST√ÉO DE EQUIPES
        function adicionarEquipe(tipo) {
            hasUnsavedChanges = false;
            currentModalId = 'modalEquipe';
            
            document.getElementById('modalEquipeTitle').textContent = `Adicionar Equipe - ${tipo}`;
            document.getElementById('equipeTipo').value = tipo;
            document.getElementById('equipeIndex').value = '-1';
            
            const numeroEquipe = gerarNumeroEquipe(tipo);
            document.getElementById('equipeNumero').value = numeroEquipe;
            
            populateEquipeOptions(tipo);
            clearEquipeForm();
            setupImplementos(tipo);

            setTimeout(() => {
                const form = document.getElementById('formEquipe');
                form.addEventListener('input', () => {
                    hasUnsavedChanges = true;
                });
            }, 100);
            
            document.getElementById('modalEquipe').classList.add('show');
        }

        function gerarNumeroEquipe(tipo) {
            const equipesDoTipo = currentRelatorio.equipes.filter(e => e.tipo === tipo);
            const numero = equipesDoTipo.length + 1;
            const prefixos = { 'Alta Pressao': 'AP', 'Auto Vacuo / Hiper Vacuo': 'AV', 'Horas Extras': 'HE' };
            const dataAtual = new Date();
            const dia = dataAtual.getDate().toString().padStart(2, '0');
            const mes = (dataAtual.getMonth() + 1).toString().padStart(2, '0');
            return `${prefixos[tipo]}-${dia}${mes}-${numero.toString().padStart(2, '0')}`;
        }

        function populateEquipeOptions(tipo) {
            const vagaSelect = document.getElementById('equipeVaga');
            const equipamentoSelect = document.getElementById('equipeEquipamento');
            
            vagaSelect.innerHTML = '<option value="">Selecione a vaga...</option>';
            let vagas = systemData.vagas || DEFAULT_SYSTEM_DATA.vagas || [];
            vagas = sanitizeObject(vagas);
            vagas.forEach(vaga => {
                const vagaLimpa = sanitizeText(vaga);
                vagaSelect.innerHTML += `<option value="${vagaLimpa}">${vagaLimpa}</option>`;
            });
            vagaSelect.innerHTML += '<option value="Outro">Outro (digite manualmente)</option>';
            
            equipamentoSelect.innerHTML = '<option value="">Selecione o equipamento...</option>';
            let equipamentos = systemData.equipamentos || DEFAULT_SYSTEM_DATA.equipamentos;
            equipamentos = sanitizeObject(equipamentos);
            Object.keys(equipamentos).forEach(categoria => {
                const categoriaLimpa = sanitizeText(categoria);
                equipamentoSelect.innerHTML += `<optgroup label="${categoriaLimpa}">`;
                equipamentos[categoria].forEach(equipamento => {
                    const equipamentoLimpo = sanitizeText(equipamento);
                    equipamentoSelect.innerHTML += `<option value="${equipamentoLimpo}">${equipamentoLimpo}</option>`;
                });
                equipamentoSelect.innerHTML += '</optgroup>';
            });
            equipamentoSelect.innerHTML += '<option value="Outro">Outro (digite manualmente)</option>';
        }

        function clearEquipeForm() {
            const turnosContainer = document.getElementById('turnosTrabalhoContainer');
            const turnosBackup = turnosContainer.innerHTML;
            
            document.getElementById('formEquipe').reset();

            const isMultiTurno = document.getElementById('multiTurno')?.checked;
            if (isMultiTurno && !turnosBackup.includes('Clique em')) {
                setTimeout(() => {
                    turnosContainer.innerHTML = turnosBackup;
                }, 50);
            }
            
            document.getElementById('pendenciaContainer').classList.add('hidden');
            document.getElementById('atrasoEquipeDetalhes').classList.add('hidden');
            document.getElementById('campoOutroVaga').classList.add('hidden');
            document.getElementById('campoOutroEquipamento').classList.add('hidden');
            document.getElementById('trocasContainer').innerHTML = '<p style="color: var(--gray-500); text-align: center; font-style: italic;">Nenhuma troca registrada</p>';
            
            document.getElementById('atrasoEquipeNao').checked = true;
            document.getElementById('horarioDirecionamento').value = '';
            document.getElementById('motivoAtrasoEquipe').value = '';
            document.getElementById('justificativaAtrasoEquipe').value = '';
            
            document.getElementById('turnoUnico').checked = true;
            toggleRegimeTurno();
        }

        function setupImplementos(tipo) {
            const container = document.getElementById('implementosContainer');
            const implementos = IMPLEMENTOS_CONFIG[tipo] || {};
            
            if (Object.keys(implementos).length === 0) {
                container.innerHTML = '<p style="color: var(--gray-500); text-align: center;">Nenhum implemento espec√≠fico para este tipo de equipe.</p>';
                return;
            }
            
            let html = '<div class="implementos-grid">';
            for (const [nome, config] of Object.entries(implementos)) {
                html += `<div class="implemento-item"><label>${nome}:</label><select name="implemento_${nome.replace(/[^a-zA-Z0-9]/g, '_')}" class="form-select">${config.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}</select></div>`;
            }
            html += '</div>';
            
            html += `<div class="form-group" style="margin-top: 1rem;"><label class="form-label">Justificativa (se algum material em Falta):</label><textarea name="justificativa_implementos" class="form-textarea" rows="2" placeholder="Descreva os motivos caso algum item esteja em falta..."></textarea></div><div style="margin-top: 1.5rem;"><h6 style="margin-bottom: 1rem; color: var(--secondary-color);">Seguran√ßa</h6><div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;"><div><label class="form-label">Caixa Bloqueio:</label><div style="display: flex; gap: 1rem;"><div class="form-radio"><input type="radio" name="caixa_bloqueio" value="Sim"><label>Sim</label></div><div class="form-radio"><input type="radio" name="caixa_bloqueio" value="N√£o" checked><label>N√£o</label></div></div></div><div><label class="form-label">Cadeados:</label><select name="cadeados" class="form-select"><option value="N/A">N/A</option><option value="Em Falta">Em Falta</option>${Array.from({length: 31}, (_, i) => `<option value="${i}">${i}</option>`).join('')}<option value="Mais de 30">Mais de 30</option></select></div><div><label class="form-label">Plaquetas:</label><select name="plaquetas" class="form-select"><option value="N/A">N/A</option><option value="Em Falta">Em Falta</option>${Array.from({length: 31}, (_, i) => `<option value="${i}">${i}</option>`).join('')}<option value="Mais de 30">Mais de 30</option></select></div></div></div>`;
            container.innerHTML = html;
        }

        function togglePendencia() {
            const status = document.getElementById('equipeStatusAtividade').value;
            const container = document.getElementById('pendenciaContainer');
            
            if (status === 'Conclu√≠do') {
                container.classList.add('hidden');
                document.getElementById('equipePendencia').required = false;
            } else {
                container.classList.remove('hidden');
                document.getElementById('equipePendencia').required = true;
            }
        }

        function adicionarTroca() {
            const container = document.getElementById('trocasContainer');
            if (container.innerHTML.includes('Nenhuma troca registrada')) container.innerHTML = '';
            const trocaIndex = container.children.length;
            container.innerHTML += `<div class="troca-item" id="troca_${trocaIndex}"><div class="troca-header"><h6 class="troca-title">Troca ${trocaIndex + 1}</h6><button type="button" class="btn-remove-troca" onclick="removerTroca(${trocaIndex})">Remover</button></div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;"><div class="form-group"><label class="form-label">Motivo *</label><select name="troca_motivo_${trocaIndex}" class="form-select" required><option value="">Selecione...</option><option>Manuten√ß√£o Preventiva</option><option>Manuten√ß√£o Corretiva</option><option>Solicita√ß√£o Do Cliente</option><option>Defeitos Em Geral</option><option>Outros Motivos</option></select></div><div class="form-group"><label class="form-label">Nova Placa</label><input type="text" name="troca_placa_${trocaIndex}" class="form-input" placeholder="AAA-0000"></div></div><div class="form-group"><label class="form-label">Defeito / Medidas Tomadas *</label><textarea name="troca_defeito_${trocaIndex}" class="form-textarea" required placeholder="Descreva o defeito e as medidas"></textarea></div><div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;"><div class="form-group"><label class="form-label">Data/Hora IN√çCIO</label><input type="datetime-local" name="troca_inicio_${trocaIndex}" class="form-input"></div><div class="form-group"><label class="form-label">Data/Hora FIM</label><input type="datetime-local" name="troca_fim_${trocaIndex}" class="form-input"></div></div></div>`;
        }

        function removerTroca(index) {
            const trocaElement = document.getElementById(`troca_${index}`);
            if (trocaElement) {
                trocaElement.remove();
                const container = document.getElementById('trocasContainer');
                if (container.children.length === 0) container.innerHTML = '<p style="color: var(--gray-500); text-align: center; font-style: italic;">Nenhuma troca registrada</p>';
            }
        }

        function salvarEquipe(event) {
            event.preventDefault();
            if (!validateEquipeForm()) return;
            hasUnsavedChanges = false;
            const equipeData = collectEquipeData();
            const index = parseInt(document.getElementById('equipeIndex').value);
            if (index === -1) currentRelatorio.equipes.push(equipeData);
            else currentRelatorio.equipes[index] = equipeData;
            updateTeamsDisplay();
            closeModal('modalEquipe');
            showNotification('Equipe salva com sucesso!', 'success');
        }

        function validateEquipeForm() {
            const required = document.querySelectorAll('#formEquipe [required]:not(.hidden [required])');
            let valid = true;
            required.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--danger-color)';
                    valid = false;
                } else {
                    field.style.borderColor = 'var(--gray-200)';
                }
            });
            const regime = document.querySelector('input[name="regimeTrabalho"]:checked').value;
            if (regime === 'multi-turno') {
                const turnos = document.getElementById('turnosTrabalhoContainer').querySelectorAll('.troca-item');
                if (turnos.length === 0) {
                    showNotification('‚ö†Ô∏è No modo M√∫ltiplos Turnos, voc√™ deve adicionar pelo menos um turno!', 'error');
                    return false;
                }
            }
            if (!valid) showNotification('Preencha todos os campos obrigat√≥rios!', 'warning');
            return valid;
        }

        function collectEquipeData() {
            const equipeData = {
                tipo: document.getElementById('equipeTipo').value,
                numero: document.getElementById('equipeNumero').value,
                area: document.getElementById('equipeArea').value,
                atividade: document.getElementById('equipeAtividade').value,
                tipoAtividade: document.getElementById('equipeTipoAtividade').value,
                statusAtividade: document.getElementById('equipeStatusAtividade').value,
                pendencia: document.getElementById('equipePendencia').value,
                observacoes: document.getElementById('equipeObservacoes').value
            };
            const vagaSelect = document.getElementById('equipeVaga');
            equipeData.vaga = vagaSelect.value === 'Outro' ? document.getElementById('equipeVagaOutro').value : vagaSelect.value;
            const equipamentoSelect = document.getElementById('equipeEquipamento');
            equipeData.equipamento = equipamentoSelect.value === 'Outro' ? document.getElementById('equipeEquipamentoOutro').value : equipamentoSelect.value;
            const regime = document.querySelector('input[name="regimeTrabalho"]:checked').value;
            equipeData.regimeTrabalho = { tipo: regime, turnos: [] };
            if (regime === 'turno-unico') {
                equipeData.motorista = document.getElementById('equipeMotorista').value;
                equipeData.operadores = document.getElementById('equipeOperadores').value;
            } else {
                const turnos = document.getElementById('turnosTrabalhoContainer').querySelectorAll('.troca-item');
                turnos.forEach((turno, index) => {
                    const inicio = turno.querySelector(`[name="turno_inicio_${index}"]`)?.value;
                    const fim = turno.querySelector(`[name="turno_fim_${index}"]`)?.value;
                    const motorista = turno.querySelector(`[name="turno_motorista_${index}"]`)?.value;
                    const operadores = turno.querySelector(`[name="turno_operadores_${index}"]`)?.value;
                    const obs = turno.querySelector(`[name="turno_observacoes_${index}"]`)?.value;
                    if (inicio && fim && motorista && operadores) equipeData.regimeTrabalho.turnos.push({ horarioInicio: inicio, horarioFim: fim, motorista, operadores, observacoes: obs });
                });
                equipeData.motorista = equipeData.regimeTrabalho.turnos.map(t => t.motorista).join(' / ');
                equipeData.operadores = equipeData.regimeTrabalho.turnos.map(t => t.operadores).join(' / ');
            }
            equipeData.atraso = { houve: document.querySelector('input[name="houveAtrasoEquipe"]:checked').value, horarioDirecionamento: document.getElementById('horarioDirecionamento').value, motivo: document.getElementById('motivoAtrasoEquipe').value, justificativa: document.getElementById('justificativaAtrasoEquipe').value };
            const trocas = [];
            document.getElementById('trocasContainer').querySelectorAll('.troca-item').forEach((item, index) => {
                const motivo = item.querySelector(`[name="troca_motivo_${index}"]`)?.value;
                const placa = item.querySelector(`[name="troca_placa_${index}"]`)?.value;
                const defeito = item.querySelector(`[name="troca_defeito_${index}"]`)?.value;
                const inicio = item.querySelector(`[name="troca_inicio_${index}"]`)?.value;
                const fim = item.querySelector(`[name="troca_fim_${index}"]`)?.value;
                if (motivo && defeito) trocas.push({ motivo, placaNova: placa, defeito, dataHoraInicio: inicio, dataHoraFim: fim });
            });
            equipeData.trocas = trocas;
            const implementos = {};
            document.getElementById('implementosContainer').querySelectorAll('select, textarea, input[type="radio"]:checked').forEach(input => {
                if (input.name) implementos[input.name] = input.value;
            });
            equipeData.implementos = implementos;
            return equipeData;
        }

        function updateTeamsDisplay() {
            const container = document.getElementById('teamsContainer');
            const btnProximo = document.getElementById('btnProximoRevisao');
            if (currentRelatorio.equipes.length === 0) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">‚ö†Ô∏è</div><h3>Nenhuma equipe adicionada</h3><p>Clique nos bot√µes acima para adicionar equipes ao relat√≥rio</p></div>`;
                btnProximo.disabled = true;
                return;
            }
            container.innerHTML = currentRelatorio.equipes.map((equipe, index) => {
                const isMultiTurno = equipe.regimeTrabalho?.tipo === 'multi-turno';
                let equipePessoalHTML = '';
                if (isMultiTurno && equipe.regimeTrabalho.turnos?.length > 0) {
                    equipePessoalHTML = equipe.regimeTrabalho.turnos.map((turno, tIndex) => `<div class="detail-item" style="grid-column: 1 / -1; background: var(--info-color); color: white; padding: 1rem; border-radius: 6px;"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;"><strong style="font-size: 0.95rem;">‚è∞ TURNO ${tIndex + 1}: ${turno.horarioInicio} - ${turno.horarioFim}</strong></div><div style="font-size: 0.875rem;"><div><strong>Motorista:</strong> ${turno.motorista}</div><div><strong>Operadores:</strong> ${turno.operadores}</div>${turno.observacoes ? `<div style="margin-top: 0.5rem;"><em>${turno.observacoes}</em></div>` : ''}</div></div>`).join('');
                } else {
                    equipePessoalHTML = `<div class="detail-item"><div class="detail-label">Motorista</div><div class="detail-value">${equipe.motorista}</div></div><div class="detail-item"><div class="detail-label">Operadores</div><div class="detail-value">${equipe.operadores}</div></div>`;
                }
                return `<div class="team-card ${equipe.tipo.includes('Alta') ? 'alta-pressao' : equipe.tipo.includes('Vacuo') ? 'vacuo' : 'horas-extras'}"><div class="team-header"><div class="team-info"><h3>${equipe.numero} - ${equipe.tipo}</h3><p>${isMultiTurno ? `üîÑ M√öLTIPLOS TURNOS (${equipe.regimeTrabalho.turnos.length} turnos) | √Årea: ${equipe.area}` : `Motorista: ${equipe.motorista} | √Årea: ${equipe.area}`}</p></div><div style="display: flex; gap: 0.5rem;"><button class="btn btn-sm btn-info" onclick="editarEquipe(${index})">Editar</button><button class="btn btn-sm btn-danger" onclick="removerEquipe(${index})">Remover</button></div></div><div class="team-content"><div class="team-details">${equipePessoalHTML}<div class="detail-item"><div class="detail-label">Atividade</div><div class="detail-value">${equipe.atividade}</div></div><div class="detail-item"><div class="detail-label">Tipo</div><div class="detail-value"><span class="badge badge-info">${equipe.tipoAtividade}</span></div></div><div class="detail-item"><div class="detail-label">Status</div><div class="detail-value"><span class="badge badge-${equipe.statusAtividade === 'Conclu√≠do' ? 'success' : 'warning'}">${equipe.statusAtividade}</span></div></div><div class="detail-item"><div class="detail-label">Equipamento</div><div class="detail-value">${equipe.equipamento}</div></div><div class="detail-item"><div class="detail-label">Vaga</div><div class="detail-value">${equipe.vaga}</div></div></div>${equipe.atraso && equipe.atraso.houve === 'Sim' ? `<div style="margin-top: 1rem; padding: 1rem; background: var(--warning-color); color: white; border-radius: 8px;"><strong>Atraso Registrado:</strong><br>${equipe.atraso.horarioDirecionamento ? `Direcionado √†s: ${formatarDataHora(equipe.atraso.horarioDirecionamento)}<br>` : ''}Motivo: ${equipe.atraso.motivo}<br>${equipe.atraso.justificativa ? `<small>${equipe.atraso.justificativa}</small>` : ''}</div>` : ''}${equipe.pendencia ? `<div style="margin-top: 1rem; padding: 1rem; background: var(--warning-color); color: white; border-radius: 8px;"><strong>Pend√™ncia:</strong> ${equipe.pendencia}</div>` : ''}${equipe.trocas && equipe.trocas.length > 0 ? `<div style="margin-top: 1rem; padding: 1rem; background: var(--info-color); color: white; border-radius: 8px;"><strong>Trocas de Equipamento:</strong> ${equipe.trocas.length} troca(s) registrada(s)</div>` : ''}${equipe.observacoes ? `<div style="margin-top: 1rem; padding: 1rem; background: var(--gray-100); border-radius: 8px;"><strong>Observa√ß√µes:</strong> ${equipe.observacoes}</div>` : ''}</div></div>`;
            }).join('');
            btnProximo.disabled = false;
        }

        function editarEquipe(index) {
            const equipe = currentRelatorio.equipes[index];
            document.getElementById('modalEquipeTitle').textContent = `Editar Equipe - ${equipe.tipo}`;
            document.getElementById('equipeTipo').value = equipe.tipo;
            document.getElementById('equipeIndex').value = index;
            populateEquipeOptions(equipe.tipo);
            setupImplementos(equipe.tipo);
            setTimeout(() => {
                document.getElementById('equipeNumero').value = equipe.numero;
                document.getElementById('equipeArea').value = equipe.area;
                document.getElementById('equipeAtividade').value = equipe.atividade;
                document.getElementById('equipeTipoAtividade').value = equipe.tipoAtividade;
                document.getElementById('equipeStatusAtividade').value = equipe.statusAtividade;
                document.getElementById('equipePendencia').value = equipe.pendencia || '';
                document.getElementById('equipeVaga').value = equipe.vaga;
                document.getElementById('equipeEquipamento').value = equipe.equipamento;
                document.getElementById('equipeObservacoes').value = equipe.observacoes || '';
                if (equipe.regimeTrabalho?.tipo === 'multi-turno') {
                    document.getElementById('multiTurno').checked = true;
                    toggleRegimeTurno();
                    const turnosContainer = document.getElementById('turnosTrabalhoContainer');
                    turnosContainer.innerHTML = '';
                    equipe.regimeTrabalho.turnos.forEach((turno, turnoIndex) => {
                        adicionarTurnoTrabalho();
                        setTimeout(() => {
                            document.querySelector(`[name="turno_inicio_${turnoIndex}"]`).value = turno.horarioInicio;
                            document.querySelector(`[name="turno_fim_${turnoIndex}"]`).value = turno.horarioFim;
                            document.querySelector(`[name="turno_motorista_${turnoIndex}"]`).value = turno.motorista;
                            document.querySelector(`[name="turno_operadores_${turnoIndex}"]`).value = turno.operadores;
                            document.querySelector(`[name="turno_observacoes_${turnoIndex}"]`).value = turno.observacoes || '';
                        }, 50);
                    });
                } else {
                    document.getElementById('turnoUnico').checked = true;
                    toggleRegimeTurno();
                    document.getElementById('equipeMotorista').value = equipe.motorista;
                    document.getElementById('equipeOperadores').value = equipe.operadores;
                }
                if (equipe.atraso && equipe.atraso.houve === 'Sim') {
                    document.getElementById('atrasoEquipeSim').checked = true;
                    toggleAtrasoEquipe();
                    document.getElementById('horarioDirecionamento').value = equipe.atraso.horarioDirecionamento || '';
                    document.getElementById('motivoAtrasoEquipe').value = equipe.atraso.motivo || '';
                    document.getElementById('justificativaAtrasoEquipe').value = equipe.atraso.justificativa || '';
                }
                if (equipe.trocas && equipe.trocas.length > 0) {
                    const trocasContainer = document.getElementById('trocasContainer');
                    trocasContainer.innerHTML = '';
                    equipe.trocas.forEach((troca, trocaIndex) => {
                        adicionarTroca();
                        setTimeout(() => {
                            const trocaElement = document.getElementById(`troca_${trocaIndex}`);
                            if (trocaElement) {
                                trocaElement.querySelector(`[name="troca_motivo_${trocaIndex}"]`).value = troca.motivo || '';
                                trocaElement.querySelector(`[name="troca_placa_${trocaIndex}"]`).value = troca.placaNova || '';
                                trocaElement.querySelector(`[name="troca_defeito_${trocaIndex}"]`).value = troca.defeito || '';
                                trocaElement.querySelector(`[name="troca_inicio_${trocaIndex}"]`).value = troca.dataHoraInicio || '';
                                trocaElement.querySelector(`[name="troca_fim_${trocaIndex}"]`).value = troca.dataHoraFim || '';
                            }
                        }, 100);
                    });
                }
                if (equipe.implementos) {
                    Object.entries(equipe.implementos).forEach(([name, value]) => {
                        const input = document.querySelector(`[name="${name}"]`);
                        if (input) {
                            if (input.type === 'radio') {
                                const radioInput = document.querySelector(`[name="${name}"][value="${value}"]`);
                                if (radioInput) radioInput.checked = true;
                            } else {
                                input.value = value;
                            }
                        }
                    });
                }
                togglePendencia();
            }, 100);
            document.getElementById('modalEquipe').classList.add('show');
        }

        function removerEquipe(index) {
            if (confirm('Tem certeza que deseja remover esta equipe?')) {
                currentRelatorio.equipes.splice(index, 1);
                updateTeamsDisplay();
                showNotification('Equipe removida!', 'info');
            }
        }

        // REVIS√ÉO E FINALIZA√á√ÉO
        function generateReview() {
            const resumoTurno = document.getElementById('resumoTurno');
            const resumoEquipes = document.getElementById('resumoEquipes');
            resumoTurno.innerHTML = `<div class="detail-item"><div class="detail-label">Data</div><div class="detail-value">${formatarData(currentRelatorio.dadosTurno.data)}</div></div><div class="detail-item"><div class="detail-label">Hor√°rio</div><div class="detail-value">${currentRelatorio.dadosTurno.horario}</div></div><div class="detail-item"><div class="detail-label">Letra</div><div class="detail-value">${currentRelatorio.dadosTurno.letra}</div></div><div class="detail-item"><div class="detail-label">Supervisor</div><div class="detail-value">${currentRelatorio.dadosTurno.supervisor}</div></div>`;
            if (currentRelatorio.testeEtilometro) {
                const etilometro = currentRelatorio.testeEtilometro;
                const ausencias = etilometro.colaboradoresAusentes?.length || 0;
                resumoTurno.innerHTML += `<div class="detail-item" style="grid-column: 1 / -1;"><div class="detail-label">Teste de Etil√¥metro</div><div class="detail-value"><span class="badge badge-${etilometro.realizado ? 'success' : 'warning'}">${etilometro.realizado ? 'Todos Realizaram' : `${ausencias} Aus√™ncia(s)`}</span><small style="display: block; margin-top: 0.5rem; color: var(--gray-600);">Realizado √†s ${etilometro.horarioTeste}</small></div></div>`;
            }
            if (currentRelatorio.faltasColaboradores) {
                const faltas = currentRelatorio.faltasColaboradores;
                const numFaltas = faltas.faltas?.length || 0;
                resumoTurno.innerHTML += `<div class="detail-item" style="grid-column: 1 / -1;"><div class="detail-label">Faltas de Colaboradores</div><div class="detail-value"><span class="badge badge-${faltas.houveFaltas ? 'danger' : 'success'}">${faltas.houveFaltas ? `${numFaltas} Falta(s)` : 'Sem Faltas'}</span></div></div>`;
            }
            const totalEquipes = currentRelatorio.equipes.length;
            const equipesAltaPressao = currentRelatorio.equipes.filter(e => e.tipo.includes('Alta')).length;
            const equipesVacuo = currentRelatorio.equipes.filter(e => e.tipo.includes('Vacuo')).length;
            const equipesExtras = currentRelatorio.equipes.filter(e => e.tipo.includes('Extras')).length;
            const atividadesConcluidas = currentRelatorio.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length;
            const totalTrocas = currentRelatorio.equipes.reduce((sum, e) => sum + (e.trocas ? e.trocas.length : 0), 0);
            const equipesComAtraso = currentRelatorio.equipes.filter(e => e.atraso && e.atraso.houve === 'Sim').length;
            resumoEquipes.innerHTML = `<div class="stats-grid"><div class="stat-card"><div class="stat-value">${totalEquipes}</div><div class="stat-label">Total de Equipes</div></div><div class="stat-card"><div class="stat-value">${equipesAltaPressao}</div><div class="stat-label">Alta Press√£o</div></div><div class="stat-card"><div class="stat-value">${equipesVacuo}</div><div class="stat-label">Vacuo/Hiper</div></div><div class="stat-card"><div class="stat-value">${equipesExtras}</div><div class="stat-label">Horas Extras</div></div><div class="stat-card"><div class="stat-value">${atividadesConcluidas}</div><div class="stat-label">Conclu√≠das</div></div><div class="stat-card"><div class="stat-value">${totalTrocas}</div><div class="stat-label">Trocas de Equipamento</div></div><div class="stat-card"><div class="stat-value">${equipesComAtraso}</div><div class="stat-label">Equipamentos com Atraso</div></div></div>`;
        }

        async function salvarRelatorio() {
            if (!currentRelatorio.testeEtilometro) {
                showNotification('‚ùå Dados do teste de etil√¥metro n√£o foram coletados!', 'error'); return;
            }
            if (!currentRelatorio.faltasColaboradores) {
                showNotification('‚ùå Dados de faltas n√£o foram coletados!', 'error'); return;
            }
            for (const equipe of currentRelatorio.equipes) {
                if (equipe.regimeTrabalho?.tipo === 'multi-turno' && (!equipe.regimeTrabalho.turnos || equipe.regimeTrabalho.turnos.length === 0)) {
                    showNotification(`‚ùå Equipe ${equipe.numero} est√° em modo multi-turno mas n√£o tem turnos registrados!`, 'error'); return;
                }
            }
            showLoading('Salvando relat√≥rio...');
            try {
                const relatorioId = `REL${Date.now()}`;
                const observacoesGerais = document.getElementById('observacoesGeraisTurno').value;
                const relatorio = { id: relatorioId, ...currentRelatorio, observacoesGerais, estatisticas: { totalEquipes: currentRelatorio.equipes.length, atividadesConcluidas: currentRelatorio.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length, totalTrocas: currentRelatorio.equipes.reduce((sum, e) => sum + (e.trocas ? e.trocas.length : 0), 0), equipesComAtraso: currentRelatorio.equipes.filter(e => e.atraso && e.atraso.houve === 'Sim').length }, criadoPor: currentUser, criadoEm: new Date().toISOString() };
                relatorios.unshift(relatorio);
                if (GITHUB_CONFIG.token) {
                    try {
                        await saveDataToGitHub('relatorios', relatorios);
                        showNotification('‚úÖ Relat√≥rio salvo no GitHub!', 'success');
                    } catch (gitError) {
                        console.error('Erro ao salvar no GitHub:', gitError);
                        showNotification('‚ö†Ô∏è Erro ao salvar no GitHub. Salvo localmente.', 'warning');
                        relatorios.shift();
                        throw gitError;
                    }
                } else {
                    throw new Error('Token do GitHub n√£o configurado');
                }
                localStorage.setItem('grupogps_relatorio_backup', JSON.stringify(sanitizeObject(relatorios)));
                document.getElementById('relatorioIdDisplay').textContent = relatorioId;
                showStep(4);
                updateInterface();
                hideLoading();
            } catch (error) {
                hideLoading();
                console.error('Erro ao salvar relat√≥rio:', error);
                try {
                    const localRelatorios = JSON.parse(localStorage.getItem('grupogps_relatorio_backup') || '[]');
                    const relatorioLocal = { id: `LOCAL${Date.now()}`, ...currentRelatorio, observacoesGerais: document.getElementById('observacoesGeraisTurno').value, salvoLocalmente: true, criadoPor: currentUser, criadoEm: new Date().toISOString() };
                    const relatorioLimpo = sanitizeObject(relatorioLocal);
                    localRelatorios.unshift(relatorioLimpo);
                    localStorage.setItem('grupogps_relatorio_backup', JSON.stringify(sanitizeObject(localRelatorios)));
                    relatorios.unshift(relatorioLimpo);
                    updateInterface();
                    document.getElementById('relatorioIdDisplay').textContent = relatorioLimpo.id + ' (Local)';
                    showStep(4);
                    showNotification('Relat√≥rio salvo localmente. Ser√° sincronizado quando houver conex√£o.', 'warning');
                } catch (localError) {
                    showNotification('Erro ao salvar relat√≥rio: ' + error.message, 'error');
                }
            }
        }

        function novoRelatorio() {
            currentRelatorio = { dadosTurno: {}, equipes: [] };
            document.getElementById('formEquipe').reset();
            document.getElementById('observacoesGeraisTurno').value = '';
            setupDefaultDate();
            showStep(1);
            updateTeamsDisplay();
        }

        function visualizarRelatorio() {
            currentRelatorio.observacoesGerais = document.getElementById('observacoesGeraisTurno').value;
            const relatorio = gerarTextoRelatorio(currentRelatorio);
            document.getElementById('relatorioTexto').textContent = relatorio;
            document.getElementById('modalVisualizarRelatorio').classList.add('show');
        }

        function gerarTextoRelatorio(relatorioData) {
            const { dadosTurno, equipes, observacoesGerais, testeEtilometro, faltasColaboradores, equipamentosDevendo } = relatorioData;
            let relatorio = `RELAT√ìRIO DE TURNO - GRUPOGPS\n========================================\nData: ${formatarData(dadosTurno.data)}\nHor√°rio: ${dadosTurno.horario}\nLetra do Turno: ${dadosTurno.letra}\nSupervisor: ${dadosTurno.supervisor}\n`;
            if (testeEtilometro) {
                relatorio += `\nTESTE DE ETIL√îMETRO:\n------------------------------\nHor√°rio do Teste: ${testeEtilometro.horarioTeste}\nRespons√°vel: ${testeEtilometro.responsavel}\nStatus: ${testeEtilometro.realizado ? 'Todos realizaram' : 'Houve aus√™ncias'}\n`;
                if (!testeEtilometro.realizado && testeEtilometro.colaboradoresAusentes?.length > 0) {
                    relatorio += `\nCOLABORADORES AUSENTES:\n`;
                    testeEtilometro.colaboradoresAusentes.forEach((a, i) => { relatorio += `${i + 1}. ${a.nome}\n   Motivo: ${a.motivo}\n${a.observacao ? `   Obs: ${a.observacao}\n` : ''}`; });
                }
                if (testeEtilometro.observacoes) relatorio += `Observa√ß√µes: ${testeEtilometro.observacoes}\n`;
            }
            if (faltasColaboradores && faltasColaboradores.houveFaltas) {
                relatorio += `\nFALTAS E SUBSTITUI√á√ïES:\n------------------------------\nTotal: ${faltasColaboradores.faltas.length}\n\n`;
                faltasColaboradores.faltas.forEach((f, i) => { relatorio += `FALTA ${i + 1}:\nColaborador: ${f.nomeColaborador}\nFun√ß√£o: ${f.funcao}\nMotivo: ${f.motivo}\nJustificada: ${f.justificada ? 'Sim' : 'N√£o'}\nSubstitui√ß√£o: ${f.houveSubstituicao ? `Sim, por ${f.nomeSubstituto}` : 'N√£o houve'}\n${f.observacoes ? `Obs: ${f.observacoes}\n` : ''}\n`; });
            } else {
                relatorio += `\nFALTAS: N√£o houve faltas neste turno.\n`;
            }
            if (equipamentosDevendo && equipamentosDevendo.ficouDevendo) {
                relatorio += `\nEQUIPAMENTOS N√ÉO ATENDIDOS (DEVENDO):\n------------------------------\nTotal: ${equipamentosDevendo.equipamentos.length}\n\n`;
                equipamentosDevendo.equipamentos.forEach((eq, i) => { relatorio += `EQUIPAMENTO ${i + 1}:\nVaga: ${eq.vaga}\nMotivo: ${eq.motivo}\nDetalhes: ${eq.observacoes}\n\n`; });
            } else {
                relatorio += `\nEQUIPAMENTOS: Todos atendidos. Nenhum equipamento ficou devendo.\n`;
            }
            relatorio += `\nDETALHES DAS EQUIPES:\n========================================\n`;
            equipes.forEach((equipe, index) => {
                relatorio += `\n${index + 1}. EQUIPE ${equipe.numero} - ${equipe.tipo.toUpperCase()}\n----------------------------------------\n`;
                const isMultiTurno = equipe.regimeTrabalho?.tipo === 'multi-turno';
                if (isMultiTurno && equipe.regimeTrabalho.turnos?.length > 0) {
                    relatorio += `REGIME: M√öLTIPLOS TURNOS (${equipe.regimeTrabalho.turnos.length} turnos)\n\n`;
                    equipe.regimeTrabalho.turnos.forEach((t, i) => { relatorio += `   TURNO ${i + 1}: ${t.horarioInicio} - ${t.horarioFim}\n   Motorista: ${t.motorista}\n   Operadores: ${t.operadores}\n${t.observacoes ? `   Obs: ${t.observacoes}\n` : ''}\n`; });
                } else {
                    relatorio += `Motorista: ${equipe.motorista}\nOperadores: ${equipe.operadores}\n`;
                }
                relatorio += `√Årea: ${equipe.area}\nAtividade: ${equipe.atividade}\nTipo: ${equipe.tipoAtividade}\nStatus: ${equipe.statusAtividade}\n${equipe.pendencia ? `PEND√äNCIA: ${equipe.pendencia}\n` : ''}Vaga: ${equipe.vaga}\nEquipamento: ${equipe.equipamento}\n`;
                if (equipe.atraso && equipe.atraso.houve === 'Sim') relatorio += `\nATRASO: ${equipe.atraso.motivo} - ${equipe.atraso.justificativa}\n`;
                if (equipe.trocas && equipe.trocas.length > 0) equipe.trocas.forEach((t, i) => { relatorio += `\nTROCA ${i + 1}: ${t.motivo}\n${t.placaNova ? `Nova Placa: ${t.placaNova}\n` : ''}Defeito: ${t.defeito}\n`; });
                if (equipe.observacoes) relatorio += `\nObserva√ß√µes: ${equipe.observacoes}\n`;
            });
            if (observacoesGerais) relatorio += `\nOBSERVA√á√ïES GERAIS:\n========================================\n${observacoesGerais}\n`;
            relatorio += `\n========================================\nGerado em: ${new Date().toLocaleString('pt-BR')}\n`;
            return relatorio;
        }

        function copiarRelatorio() {
            navigator.clipboard.writeText(document.getElementById('relatorioTexto').textContent).then(() => {
                showNotification('Relat√≥rio copiado!', 'success');
            });
        }

        // NAVEGA√á√ÉO ENTRE ABAS
        function switchTab(tabName) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`)?.classList.add('active');
            document.getElementById(tabName + '-tab')?.classList.add('active');
            if (tabName === 'relatorios') updateInterface();
        }

        // PESQUISA
        function ajustarCampoPesquisa() {
            const tipo = document.getElementById('tipoPesquisa').value;
            document.querySelectorAll('[id^="campoPesquisa"]').forEach(c => c.classList.add('hidden'));
            if (tipo === 'data') document.getElementById('campoPesquisaData').classList.remove('hidden');
            else if (tipo === 'periodo') {
                document.getElementById('campoPesquisaPeriodo').classList.remove('hidden');
                document.getElementById('campoPesquisaPeriodoFim').classList.remove('hidden');
            } else document.getElementById('campoPesquisaGeral').classList.remove('hidden');
        }

        function executarPesquisa() {
            const tipo = document.getElementById('tipoPesquisa').value;
            let resultados = [];
            if (!Array.isArray(relatorios) || relatorios.length === 0) {
                mostrarResultadosPesquisa([]); return;
            }
            const termo = document.getElementById('termoPesquisa').value.toLowerCase().trim();
            if (tipo === 'data') {
                const data = document.getElementById('dataPesquisa').value;
                resultados = relatorios.filter(r => r.dadosTurno?.data === data);
            } else if (tipo === 'periodo') {
                const dataInicial = document.getElementById('dataInicialPesquisa').value;
                const dataFinal = document.getElementById('dataFinalPesquisa').value;
                resultados = relatorios.filter(r => r.dadosTurno?.data >= dataInicial && r.dadosTurno?.data <= dataFinal);
            } else if (tipo === 'supervisor') {
                resultados = relatorios.filter(r => r.dadosTurno?.supervisor?.toLowerCase().includes(termo));
            } else if (tipo === 'letra') {
                resultados = relatorios.filter(r => r.dadosTurno?.letra?.toLowerCase().includes(termo));
            } else {
                resultados = relatorios.filter(r => JSON.stringify(r).toLowerCase().includes(termo));
            }
            mostrarResultadosPesquisa(resultados);
        }

        function mostrarResultadosPesquisa(resultados) {
            const container = document.getElementById('resultadosPesquisa');
            const tbody = document.getElementById('pesquisaTableBody');
            if (resultados.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><h3>Nenhum resultado</h3></div></td></tr>`;
            } else {
                tbody.innerHTML = resultados.map(r => `<tr><td>${r.id}</td><td>${formatarData(r.dadosTurno.data)}</td><td>${r.dadosTurno.horario}</td><td>${r.dadosTurno.letra}</td><td>${r.dadosTurno.supervisor}</td><td>${r.equipes.length}</td><td><button class="btn btn-sm" onclick="visualizarRelatorioSalvo('${r.id}')">Ver</button></td></tr>`).join('');
            }
            container.classList.remove('hidden');
        }

        function limparPesquisa() {
            document.getElementById('tipoPesquisa').value = 'geral';
            document.getElementById('termoPesquisa').value = '';
            document.getElementById('dataPesquisa').value = '';
            document.getElementById('dataInicialPesquisa').value = '';
            document.getElementById('dataFinalPesquisa').value = '';
            document.getElementById('resultadosPesquisa').classList.add('hidden');
            ajustarCampoPesquisa();
        }

        function visualizarRelatorioSalvo(id) {
            const relatorio = relatorios.find(r => r.id === id);
            if (!relatorio) { showNotification('Relat√≥rio n√£o encontrado!', 'error'); return; }
            const relatorioTexto = gerarTextoRelatorio(relatorio);
            document.getElementById('relatorioTexto').textContent = relatorioTexto;
            document.getElementById('modalVisualizarRelatorio').classList.add('show');
        }
        
        // EXCLUS√ÉO DE RELAT√ìRIO
        function solicitarExclusaoRelatorio(relatorioId) {
            document.getElementById('relatorioParaExcluir').value = relatorioId;
            document.getElementById('senhaExclusao').value = '';
            document.getElementById('modalConfirmarExclusao').classList.add('show');
        }

        async function confirmarExclusaoRelatorio() {
            const relatorioId = document.getElementById('relatorioParaExcluir').value;
            const senhaDigitada = document.getElementById('senhaExclusao').value;
            const SENHA_CORRETA = 'Apagar@GPS';
            
            if (senhaDigitada !== SENHA_CORRETA) {
                showNotification('‚ùå Senha incorreta! Exclus√£o n√£o autorizada.', 'error');
                document.getElementById('senhaExclusao').value = '';
                document.getElementById('senhaExclusao').focus();
                return;
            }
            
            const index = relatorios.findIndex(r => r.id === relatorioId);
            if (index === -1) {
                showNotification('‚ùå Relat√≥rio n√£o encontrado!', 'error');
                closeModal('modalConfirmarExclusao');
                return;
            }
            
            showLoading('Excluindo relat√≥rio...');
            try {
                relatorios.splice(index, 1);
                if (GITHUB_CONFIG.token) await saveDataToGitHub('relatorios', relatorios);
                localStorage.setItem('grupogps_relatorio_backup', JSON.stringify(sanitizeObject(relatorios)));
                hideLoading();
                closeModal('modalConfirmarExclusao');
                updateInterface();
                showNotification('‚úÖ Relat√≥rio exclu√≠do com sucesso!', 'success');
            } catch (error) {
                hideLoading();
                console.error('Erro ao excluir relat√≥rio:', error);
                showNotification('‚ùå Erro ao excluir: ' + error.message, 'error');
            }
        }

        // INTERFACE E ESTAT√çSTICAS
        function initializeInterface() {
            updateInterface();
            loadConfiguracoes();
        }

        function updateInterface() {
            updateRelatoriosTable();
            updateStatistics();
        }

        function updateRelatoriosTable() {
            const tbody = document.getElementById('relatoriosTableBody');
            if (!Array.isArray(relatorios) || relatorios.length === 0) {
                tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><h3>Nenhum relat√≥rio encontrado</h3></div></td></tr>`;
                return;
            }
            tbody.innerHTML = relatorios.slice(0, 50).map(r => {
                if (!r.dadosTurno) return '';
                return `<tr><td>${r.id || 'N/A'}</td><td>${formatarData(r.dadosTurno.data)}</td><td>${r.dadosTurno.horario || 'N/A'}</td><td>${r.dadosTurno.letra || 'N/A'}</td><td>${r.dadosTurno.supervisor || 'N/A'}</td><td>${r.equipes ? r.equipes.length : 0}</td><td><span class="badge badge-${r.salvoLocalmente ? 'warning' : 'success'}">${r.salvoLocalmente ? 'Local' : 'Sincronizado'}</span></td><td><button class="btn btn-sm btn-info" onclick="visualizarRelatorioSalvo('${r.id}')">Ver</button><button class="btn btn-sm btn-danger" onclick="solicitarExclusaoRelatorio('${r.id}')" style="margin-left: 0.5rem;">Excluir</button></td></tr>`;
            }).filter(row => row).join('');
            if (tbody.innerHTML.trim() === '') tbody.innerHTML = `<tr><td colspan="8"><div class="empty-state"><h3>Relat√≥rios com estrutura inv√°lida</h3></div></td></tr>`;
        }

        function updateStatistics() {
            if (!Array.isArray(relatorios)) return;
            const hoje = new Date().toISOString().split('T')[0];
            const relatoriosHoje = relatorios.filter(r => r.dadosTurno?.data === hoje).length;
            const totalEquipes = relatorios.reduce((sum, r) => sum + (r.equipes?.length || 0), 0);
            const atividadesConcluidas = relatorios.reduce((sum, r) => sum + (r.equipes?.filter(e => e.statusAtividade === 'Conclu√≠do').length || 0), 0);
            document.getElementById('totalRelatorios').textContent = relatorios.length;
            document.getElementById('relatoriosHoje').textContent = relatoriosHoje;
            document.getElementById('equipesTotal').textContent = totalEquipes;
            document.getElementById('atividadesConcluidas').textContent = atividadesConcluidas;
        }

        // CONFIGURA√á√ïES
        function salvarConfigGitHub() {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) { showNotification('Informe o token do GitHub!', 'warning'); return; }
            GITHUB_CONFIG.token = token;
            localStorage.setItem('grupogps_relatorio_githubToken', token);
            showNotification('Token do GitHub salvo!', 'success');
            document.getElementById('btnInitializeSystem').classList.remove('hidden');
            setTimeout(testarConexaoGitHub, 500);
        }

        async function initializeSystemFiles() {
            if (!GITHUB_CONFIG.token) { showNotification('Salve o token do GitHub primeiro.', 'error'); return; }
            if (!confirm('Isso criar√° a estrutura de arquivos no reposit√≥rio. Continuar?')) return;
            showLoading('Inicializando arquivos...');
            try {
                const initialData = { relatorios: [], configuracoes: { nomeEmpresa: 'GrupoGPS', autoRefreshInterval: 60, autoBackup: true }, ...sanitizeObject(DEFAULT_SYSTEM_DATA) };
                await Promise.all(Object.keys(GITHUB_CONFIG.paths).map(key => saveDataToGitHub(key, initialData[key] || [])));
                hideLoading();
                showNotification('Sistema inicializado! Recarregue a p√°gina.', 'success');
                setTimeout(() => location.reload(), 3000);
            } catch (error) {
                hideLoading();
                showNotification('Erro ao inicializar: ' + error.message, 'error');
            }
        }

        function testarConexaoGitHub() {
            const token = document.getElementById('githubToken').value.trim() || GITHUB_CONFIG.token || localStorage.getItem('grupogps_relatorio_githubToken');
            if (!token) { showNotification('Informe o token!', 'warning'); return; }
            showNotification('Testando conex√£o...', 'info');
            fetch(`https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}`, { headers: { 'Authorization': `token ${token}`, 'Accept': 'application/vnd.github.v3+json' } })
            .then(res => res.ok ? res.json() : Promise.reject(new Error(`HTTP ${res.status}: ${res.statusText}`)))
            .then(data => {
                showNotification(`‚úÖ Conex√£o OK! Reposit√≥rio: ${data.full_name}`, 'success');
                GITHUB_CONFIG.token = token;
                localStorage.setItem('grupogps_relatorio_githubToken', token);
            })
            .catch(error => showNotification('‚ùå Erro na conex√£o: ' + error.message, 'error'));
        }

        function loadConfiguracoes() {
            const tokenSalvo = localStorage.getItem('grupogps_relatorio_githubToken');
            if (tokenSalvo) { GITHUB_CONFIG.token = tokenSalvo; document.getElementById('githubToken').value = tokenSalvo; }
            if (configuracoes.nomeEmpresa) document.getElementById('nomeEmpresa').value = configuracoes.nomeEmpresa;
            if (configuracoes.autoRefreshInterval) document.getElementById('autoRefreshInterval').value = configuracoes.autoRefreshInterval;
            if (configuracoes.autoBackup !== undefined) document.getElementById('autoBackup').value = configuracoes.autoBackup.toString();
        }

        async function salvarConfigGerais() {
            configuracoes.nomeEmpresa = document.getElementById('nomeEmpresa').value;
            configuracoes.autoRefreshInterval = parseInt(document.getElementById('autoRefreshInterval').value);
            configuracoes.autoBackup = document.getElementById('autoBackup').value === 'true';
            try {
                if (GITHUB_CONFIG.token) await saveDataToGitHub('configuracoes', configuracoes);
                showNotification('Configura√ß√µes salvas!', 'success');
                startAutoRefresh();
            } catch (error) {
                showNotification('Erro ao salvar configura√ß√µes: ' + error.message, 'error');
            }
        }

        // EXPORTA√á√ÉO
        function exportarRelatorios() {
            if (!relatorios || relatorios.length === 0) { showNotification('Nenhum relat√≥rio para exportar!', 'warning'); return; }
            const dados = relatorios.map(r => ({ 'ID': r.id, 'Data': formatarData(r.dadosTurno.data), 'Hor√°rio': r.dadosTurno.horario, 'Letra': r.dadosTurno.letra, 'Supervisor': r.dadosTurno.supervisor, 'Total Equipes': r.equipes.length, 'Atividades Conclu√≠das': r.equipes.filter(e => e.statusAtividade === 'Conclu√≠do').length, 'Trocas Equipamento': r.equipes.reduce((sum, e) => sum + (e.trocas?.length || 0), 0), 'Equipamentos com Atraso': r.equipes.filter(e => e.atraso?.houve === 'Sim').length, 'Criado Por': r.criadoPor, 'Criado Em': formatarDataHora(r.criadoEm) }));
            exportarCSV(dados, 'relatorios_turno');
        }

        function exportarCSV(dados, nomeArquivo) {
            const csvContent = "data:text/csv;charset=utf-8," + Object.keys(dados[0]).join(",") + "\n" + dados.map(row => Object.values(row).join(",")).join("\n");
            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", `${nomeArquivo}_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showNotification('Arquivo exportado!', 'success');
        }

        // ATUALIZA√á√ÉO AUTOM√ÅTICA
        function startAutoRefresh() {
            if (autoRefreshTimer) clearInterval(autoRefreshTimer);
            const interval = (configuracoes.autoRefreshInterval || 60) * 1000;
            autoRefreshTimer = setInterval(async () => { if (isOnline && GITHUB_CONFIG.token) try { await loadAllDataFromGitHub(); } catch (e) {} }, interval);
        }

        async function forceRefresh() {
            if (!isOnline || !GITHUB_CONFIG.token) { showNotification('Sem conex√£o ou token', 'warning'); return; }
            showLoading('Atualizando...');
            try {
                await loadAllDataFromGitHub();
                hideLoading();
                showNotification('Dados sincronizados!', 'success');
            } catch (error) {
                hideLoading();
                showNotification('Erro ao sincronizar: ' + error.message, 'error');
            }
        }

        // FUN√á√ïES UTILIT√ÅRIAS
        function formatarData(dataISO) {
            if (!dataISO) return '-';
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function formatarDataHora(isoString) {
            if (!isoString) return '-';
            try { return new Date(isoString).toLocaleString('pt-BR', { hour12: false, timeZone: 'America/Sao_Paulo' }); } catch (e) { return isoString; }
        }

        function confirmCloseModal(modalId) {
            if (!hasUnsavedChanges || modalId !== 'modalEquipe') {
                closeModal(modalId);
                return;
            }
            if (confirm('‚ö†Ô∏è Voc√™ tem altera√ß√µes n√£o salvas. Deseja realmente sair e perder os dados?')) {
                hasUnsavedChanges = false;
                closeModal(modalId);
                clearEquipeForm();
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('show');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => { notification.remove(); }, 5000);
        }

        function showLoading(message = 'Carregando...') {
            document.getElementById('loadingText').textContent = message;
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        function updateSyncStatus(status, message) {
            const dot = document.getElementById('syncDot');
            const statusText = document.getElementById('syncStatus');
            dot.className = 'sync-dot';
            if (status === 'loading') dot.classList.add('loading');
            else if (status === 'error') dot.classList.add('error');
            statusText.textContent = message;
        }

        console.log('üöÄ Sistema de Relat√≥rio de Turno - GrupoGPS ATUALIZADO');
        console.log('üîß M√∫ltiplas corre√ß√µes e novas funcionalidades implementadas.');
        console.log('‚ú® Sistema profissional finalizado');
    </script>
</body>
</html>
